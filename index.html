<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Lock-In 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{--navy:#1B2A4A;--navy2:#243560;--gold:#B8962E;--gold-l:#F5EDD6;--cream:#FAF8F3;--white:#fff;--gray:#6B7280;--gray-l:#F3F4F6;--green:#2D6A2D;--green-l:#EAF4EA;--warn:#FFF3CD;--warn-fg:#7D5A00;--red:#DC2626;--red-l:#FEE2E2;--r:16px;--rs:10px;--sh:0 4px 24px rgba(27,42,74,.10)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--navy);min-height:100vh}
.hdr{background:var(--navy);padding:14px 18px 12px;position:sticky;top:0;z-index:100}
.hdr-row1{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.hdr-title{font-family:'Playfair Display',serif;color:var(--gold);font-size:20px;font-weight:700}
.hdr-streak{background:var(--gold);color:var(--navy);border-radius:20px;padding:4px 12px;font-size:13px;font-weight:600}
.hdr-row2{display:flex;align-items:center;justify-content:space-between;gap:8px}
.hdr-datetime{flex:1}
.hdr-date-txt{color:rgba(255,255,255,.65);font-size:12px;font-weight:500}
.hdr-clock-txt{color:var(--gold);font-family:'Playfair Display',serif;font-size:15px;margin-top:1px}
.hdr-right{display:flex;align-items:center;gap:10px}
.hdr-days-box{background:rgba(255,255,255,.1);border-radius:8px;padding:6px 10px;text-align:center}
.hdr-days-num{color:var(--gold);font-family:'Playfair Display',serif;font-size:20px;font-weight:700;line-height:1}
.hdr-days-lbl{color:rgba(255,255,255,.5);font-size:9px;margin-top:1px}
.hdr-prog-box{text-align:right}
.hdr-prog-pct{color:rgba(255,255,255,.8);font-size:12px;font-weight:600;margin-bottom:3px}
.hdr-prog-bar{width:80px;height:5px;background:rgba(255,255,255,.15);border-radius:99px;overflow:hidden}
.hdr-prog-fill{height:100%;background:var(--gold);border-radius:99px;transition:width .5s;width:0%}
.nav{background:var(--white);border-bottom:1px solid rgba(27,42,74,.08);display:flex;overflow-x:auto;scrollbar-width:none;position:sticky;top:88px;z-index:99}
.nav::-webkit-scrollbar{display:none}
.nb{padding:13px 14px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:500;color:var(--gray);border:none;background:none;cursor:pointer;white-space:nowrap;border-bottom:2px solid transparent;transition:all .2s}
.nb.active{color:var(--navy);border-bottom-color:var(--gold);font-weight:600}
.main{padding:16px 16px 120px;max-width:600px;margin:0 auto}
.card{background:var(--white);border-radius:var(--r);padding:18px;margin-bottom:14px;box-shadow:var(--sh)}
.card-title{font-family:'Playfair Display',serif;font-size:17px;font-weight:700;color:var(--navy);margin-bottom:4px}
.card-sub{font-size:12px;color:var(--gray);margin-bottom:14px}
.slbl{font-size:11px;font-weight:600;color:var(--gray);text-transform:uppercase;letter-spacing:1px;margin:14px 0 8px}
.energy-row{display:flex;gap:6px;flex-wrap:wrap}
.ebtn{width:38px;height:38px;border-radius:50%;border:2px solid var(--gray-l);background:var(--white);font-size:13px;font-weight:600;color:var(--gray);cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif}
.ebtn.active{background:var(--navy);border-color:var(--navy);color:var(--white)}
.ci{display:flex;align-items:center;gap:12px;padding:11px 0;border-bottom:1px solid var(--gray-l);cursor:pointer;user-select:none}
.ci:last-child{border-bottom:none}
.cb{width:22px;height:22px;min-width:22px;border:2px solid var(--gray-l);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all .2s}
.cb.done{background:var(--green);border-color:var(--green);color:#fff}
.cl{font-size:14px;flex:1}
.cl.done{color:var(--gray);text-decoration:line-through}
.btn{padding:12px 18px;border-radius:var(--rs);font-family:'DM Sans',sans-serif;font-size:14px;font-weight:600;cursor:pointer;border:none;transition:all .2s;display:inline-flex;align-items:center;justify-content:center;gap:8px;width:100%}
.btn-gold{background:var(--gold);color:var(--navy)}
.btn-navy{background:var(--navy);color:#fff}
.btn-ghost{background:var(--gray-l);color:var(--navy)}
.btn-green{background:var(--green-l);color:var(--green)}
.btn-red{background:var(--red-l);color:var(--red)}
.btn-sm{padding:7px 13px;font-size:13px;border-radius:8px;width:auto}
.task-item{display:flex;align-items:center;gap:11px;padding:12px;background:var(--cream);border-radius:var(--rs);margin-bottom:8px;cursor:pointer;border:1.5px solid transparent;transition:all .2s}
.task-item:hover{border-color:var(--gold-l)}
.task-item.done{opacity:.55}
.task-check{width:24px;height:24px;min-width:24px;border:2px solid var(--gray-l);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:13px;transition:all .2s}
.task-check.done{background:var(--green);border-color:var(--green);color:#fff}
.task-info{flex:1}
.task-title{font-size:14px;font-weight:500}
.task-cat{font-size:12px;color:var(--gray);margin-top:2px}
.badge{font-size:11px;font-weight:600;padding:3px 8px;border-radius:99px}
.b-pend{background:var(--gray-l);color:var(--gray)}
.b-done{background:var(--green-l);color:var(--green)}
.b-part{background:var(--warn);color:var(--warn-fg)}
.pbw{background:var(--gray-l);border-radius:99px;height:7px;overflow:hidden;margin:8px 0 3px}
.pbf{height:100%;background:linear-gradient(90deg,var(--gold),var(--navy));border-radius:99px;transition:width .5s}
.plbl{font-size:12px;color:var(--gray);display:flex;justify-content:space-between}
.cat-hdr{display:flex;align-items:center;justify-content:space-between;padding:11px 0 8px;cursor:pointer}
.cat-name{font-family:'Playfair Display',serif;font-size:16px;font-weight:700}
.cat-prog{font-size:12px;color:var(--gray);background:var(--gray-l);padding:3px 9px;border-radius:20px}
.task-group{border-left:3px solid var(--gold-l);margin:0 0 10px 6px;padding-left:14px}
.wbs-task{font-size:14px;font-weight:600;padding:8px 0 5px;display:flex;align-items:center;gap:7px}
.wbs-task.done{color:var(--gray)}
.mt-row{display:flex;align-items:center;gap:9px;padding:7px 0;border-bottom:1px solid rgba(27,42,74,.05);cursor:pointer}
.mt-row:last-child{border-bottom:none}
.mt-check{width:17px;height:17px;min-width:17px;border:2px solid var(--gray-l);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:10px;transition:all .2s}
.mt-check.done{background:var(--gold);border-color:var(--gold);color:#fff}
.mt-lbl{font-size:13px;flex:1}
.mt-lbl.done{color:var(--gray);text-decoration:line-through}
/* SUPPLEMENT CHECKLIST */
.suppl-check-item{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--gray-l);cursor:pointer;user-select:none}
.suppl-check-item:last-child{border-bottom:none}
.suppl-cb{width:22px;height:22px;min-width:22px;border:2px solid var(--gray-l);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;transition:all .2s}
.suppl-cb.done{background:var(--gold);border-color:var(--gold);color:#fff}
.suppl-item-info{flex:1}
.suppl-item-name{font-size:14px;font-weight:500}
.suppl-item-note{font-size:11px;color:var(--gray);margin-top:2px}
.suppl-all-done{background:var(--green-l);border-radius:var(--rs);padding:12px;text-align:center;font-size:14px;font-weight:600;color:var(--green);margin-top:12px;display:none}
/* ZINCIR */
.z-hero{background:linear-gradient(135deg,var(--navy),var(--navy2));border-radius:var(--r);padding:22px 18px;margin-bottom:14px;display:flex;align-items:center;gap:18px}
.z-num{font-family:'Playfair Display',serif;font-size:60px;font-weight:700;color:var(--gold);line-height:1}
.z-info{flex:1}
.z-lbl{color:#fff;font-size:16px;font-weight:600}
.z-sub{color:rgba(255,255,255,.5);font-size:12px;margin-top:4px}
.z-rec{color:var(--gold-l);font-size:13px;margin-top:8px;font-weight:500}
.h-card{background:var(--white);border-radius:var(--r);padding:16px;margin-bottom:12px;box-shadow:var(--sh)}
.h-top{display:flex;align-items:center;gap:11px;margin-bottom:12px}
.h-icon{font-size:24px;width:36px;text-align:center}
.h-info{flex:1}
.h-name{font-size:15px;font-weight:600}
.h-sub{font-size:12px;color:var(--gray);margin-top:2px}
.h-streak{text-align:right}
.h-s-num{font-family:'Playfair Display',serif;font-size:30px;font-weight:700;color:var(--gold);line-height:1}
.h-s-lbl{font-size:10px;color:var(--gray)}
.tick-btn{width:38px;height:38px;min-width:38px;border-radius:50%;border:2px solid var(--gray-l);background:var(--white);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;margin-left:6px}
.tick-btn.done{background:var(--green);border-color:var(--green);color:#fff}
.edit-btn{width:32px;height:32px;min-width:32px;border-radius:50%;border:1.5px solid var(--gray-l);background:var(--white);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;margin-left:4px}
.cal-wrap{overflow-x:auto;padding-bottom:2px}
.cal-row{display:flex;gap:4px;min-width:max-content}
.cal-day{width:32px;flex-shrink:0;display:flex;flex-direction:column;align-items:center;gap:3px}
.cal-box{width:32px;height:32px;border-radius:7px;border:1.5px solid var(--gray-l);display:flex;align-items:center;justify-content:center;font-size:13px;background:var(--white)}
.cal-box.hit{background:var(--gold);border-color:var(--gold);color:#fff}
.cal-box.today{border-color:var(--navy);border-width:2px}
.cal-box.today.hit{background:var(--navy);border-color:var(--navy);color:#fff}
.cal-box.fut{background:var(--gray-l);border-color:var(--gray-l)}
.cal-lbl{font-size:9px;color:var(--gray);font-weight:600}
.cal-lbl.today{color:var(--navy);font-weight:700}
.h-best{font-size:11px;color:var(--gold);font-weight:600;margin-top:8px}
/* MIND DUMP */
.md-item{display:flex;align-items:flex-start;gap:10px;padding:11px;background:var(--cream);border-radius:var(--rs);margin-bottom:8px}
.md-item.done{opacity:.5}
.md-text{flex:1;font-size:14px;line-height:1.5}
.md-text.done{text-decoration:line-through;color:var(--gray)}
.md-prio{font-size:10px;font-weight:600;padding:2px 7px;border-radius:99px;white-space:nowrap}
.p-hi{background:var(--red-l);color:var(--red)}
.p-md{background:var(--warn);color:var(--warn-fg)}
.p-lo{background:var(--green-l);color:var(--green)}
.md-btn{width:28px;height:28px;border-radius:6px;border:none;background:var(--gray-l);color:var(--gray);cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center}
.prio-row{display:flex;gap:7px;margin-top:6px}
.prio-btn{flex:1;padding:8px;border-radius:8px;border:1.5px solid var(--gray-l);background:var(--white);font-size:13px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif}
.prio-btn.sel-hi{background:var(--red-l);border-color:var(--red);color:var(--red)}
.prio-btn.sel-md{background:var(--warn);border-color:var(--warn-fg);color:var(--warn-fg)}
.prio-btn.sel-lo{background:var(--green-l);border-color:var(--green);color:var(--green)}
/* LOG (okuma/izleme/dinleme) */
.log-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--cream);border-radius:var(--rs);margin-bottom:8px}
.log-type-badge{font-size:18px;width:36px;text-align:center}
.log-info{flex:1}
.log-title{font-size:14px;font-weight:500}
.log-meta{font-size:12px;color:var(--gray);margin-top:2px}
.log-del{width:28px;height:28px;border-radius:6px;border:none;background:var(--gray-l);color:var(--gray);cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.type-tabs{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}
.type-tab{padding:7px 14px;border-radius:99px;border:1.5px solid var(--gray-l);background:var(--white);font-size:13px;font-weight:500;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s}
.type-tab.active{background:var(--navy);border-color:var(--navy);color:#fff}
/* MODAL */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;display:flex;align-items:flex-end;justify-content:center}
.modal{background:var(--white);border-radius:var(--r) var(--r) 0 0;padding:22px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto}
.modal-title{font-family:'Playfair Display',serif;font-size:18px;font-weight:700;margin-bottom:14px}
.ifield{width:100%;padding:11px;border:1.5px solid var(--gray-l);border-radius:var(--rs);font-family:'DM Sans',sans-serif;font-size:14px;color:var(--navy);outline:none;background:var(--cream)}
.ifield:focus{border-color:var(--gold)}
.emoji-grid{display:flex;flex-wrap:wrap;gap:7px;margin:8px 0}
.eg-btn{width:38px;height:38px;border-radius:8px;border:1.5px solid var(--gray-l);background:var(--white);font-size:19px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.eg-btn.active{border-color:var(--gold);background:var(--gold-l)}
/* CHECKIN EDIT */
.checkin-edit-item{display:flex;align-items:center;gap:10px;padding:10px;background:var(--cream);border-radius:var(--rs);margin-bottom:6px}
.checkin-edit-item input[type=text]{flex:1;padding:8px 10px;border:1.5px solid var(--gray-l);border-radius:8px;font-family:'DM Sans',sans-serif;font-size:13px;outline:none;background:var(--white)}
.checkin-edit-item input[type=text]:focus{border-color:var(--gold)}
.del-item-btn{width:28px;height:28px;border-radius:6px;border:none;background:var(--red-l);color:var(--red);cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
/* MISC */
.celebrate{background:linear-gradient(135deg,var(--navy),var(--navy2));border-radius:var(--r);padding:20px;text-align:center;color:#fff;margin-bottom:14px}
.cel-icon{font-size:36px;margin-bottom:7px}
.cel-title{font-family:'Playfair Display',serif;font-size:18px;color:var(--gold);font-weight:700;margin-bottom:3px}
.cel-txt{font-size:13px;opacity:.75}
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--navy);color:#fff;padding:10px 20px;border-radius:99px;font-size:14px;font-weight:500;box-shadow:0 8px 32px rgba(27,42,74,.2);opacity:0;transition:all .3s;z-index:300;white-space:nowrap;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.spin{width:28px;height:28px;border:3px solid var(--gray-l);border-top-color:var(--gold);border-radius:50%;animation:sp .8s linear infinite}
@keyframes sp{to{transform:rotate(360deg)}}
.loading{display:flex;flex-direction:column;align-items:center;gap:10px;padding:32px;color:var(--gray);font-size:13px}
.empty{text-align:center;padding:32px 16px;color:var(--gray);font-size:14px}
.empty-icon{font-size:32px;margin-bottom:8px}
.setup-step{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid var(--gray-l)}
.setup-step:last-child{border-bottom:none}
.s-num{width:26px;height:26px;min-width:26px;background:var(--navy);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}
.s-txt{font-size:13px;line-height:1.6;flex:1}
.s-txt code{background:var(--gray-l);padding:2px 5px;border-radius:4px;font-size:11px}
.ifield2{width:100%;padding:10px;border:1.5px solid var(--gray-l);border-radius:var(--rs);font-family:'DM Sans',sans-serif;font-size:14px;outline:none;background:var(--cream);margin-top:7px}
.rating-row{display:flex;gap:8px;margin-top:6px}
.rating-btn{width:36px;height:36px;border-radius:50%;border:2px solid var(--gray-l);background:var(--white);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif;color:var(--gray)}
.rating-btn.active{background:var(--gold);border-color:var(--gold);color:var(--navy)}
.wbox{background:var(--warn);border-left:4px solid var(--gold);border-radius:var(--rs);padding:10px 13px;margin-bottom:13px;font-size:13px;color:var(--warn-fg)}
.counter-row{display:flex;align-items:center;gap:8px;margin-top:8px}
.cnt-btn{width:32px;height:32px;border-radius:50%;border:2px solid var(--gray-l);background:var(--white);font-size:18px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;color:var(--navy)}
.cnt-btn:active{background:var(--gold);border-color:var(--gold)}
.cnt-val{font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--navy);min-width:50px;text-align:center}
.cnt-unit{font-size:12px;color:var(--gray)}
.kpi-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.kpi-card{background:var(--cream);border-radius:var(--rs);padding:13px;border:1px solid rgba(27,42,74,.08)}
.kpi-val{font-family:'Playfair Display',serif;font-size:24px;font-weight:700}
.kpi-lbl{font-size:12px;color:var(--gray);margin-top:3px}
.kpi-tgt{font-size:11px;color:var(--gold);font-weight:600;margin-top:2px}
</style>
</head>
<body>

<div class="hdr">
  <div class="hdr-row1">
    <div class="hdr-title">Lock-In 2025</div>
    <div class="hdr-streak" id="hdr-streak">ğŸ”¥ 0 gÃ¼n</div>
  </div>
  <div class="hdr-row2">
    <div class="hdr-datetime">
      <div class="hdr-date-txt" id="hdr-date">â€”</div>
      <div class="hdr-clock-txt" id="hdr-clock">00:00:00</div>
    </div>
    <div class="hdr-right">
      <div class="hdr-days-box">
        <div class="hdr-days-num" id="hdr-days">â€”</div>
        <div class="hdr-days-lbl">gÃ¼n kaldÄ±</div>
      </div>
      <div class="hdr-prog-box">
        <div class="hdr-prog-pct" id="hdr-prog-pct">%0</div>
        <div class="hdr-prog-bar"><div class="hdr-prog-fill" id="hdr-prog-fill"></div></div>
      </div>
    </div>
  </div>
</div>

<nav class="nav">
  <button class="nb active" onclick="showTab('bugun')">â˜€ï¸ BugÃ¼n</button>
  <button class="nb" onclick="showTab('supplement')">ğŸ’Š Supplement</button>
  <button class="nb" onclick="showTab('minddump')">ğŸ§  Mind Dump</button>
  <button class="nb" onclick="showTab('habits')">âœ… Habits</button>
  <button class="nb" onclick="showTab('zincir')">ğŸ”— Zincir</button>
  <button class="nb" onclick="showTab('wbs')">ğŸ“‹ WBS</button>
  <button class="nb" onclick="showTab('log')">ğŸ“š Log</button>
  <button class="nb" onclick="showTab('saglik')">ğŸ SaÄŸlÄ±k</button>
  <button class="nb" onclick="showTab('optimaized')">âš¡ OptimAIzed</button>
  <button class="nb" onclick="showTab('visionboard')">ğŸŒŸ Vision</button>
  <button class="nb" onclick="showTab('kpi')">ğŸ“Š KPI</button>
  <button class="nb" onclick="showTab('ayarlar')">âš™ï¸ Ayarlar</button>
</nav>

<div class="main">

<!-- BUGÃœN -->
<div id="tab-bugun">
  <div id="cel-morning" class="celebrate" style="display:none">
    <div class="cel-icon">â˜€ï¸</div>
    <div class="cel-title">Sabah check-in tamam!</div>
    <div class="cel-txt">Harika bir gÃ¼n olsun.</div>
    <div id="cel-top3-wrap" style="display:none;margin-top:10px;text-align:left;background:rgba(255,255,255,.1);border-radius:8px;padding:10px">
      <div style="font-size:11px;font-weight:600;color:var(--gold);margin-bottom:4px">ğŸ¯ BUGÃœNÃœN TOP 3</div>
      <div id="cel-top3" style="font-size:13px;color:#fff;white-space:pre-wrap;line-height:1.6"></div>
    </div>
  </div>
  <div class="card" id="card-morning">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
      <div class="card-title" style="margin-bottom:0">â˜€ï¸ Sabah Check-In</div>
      <button class="btn btn-ghost btn-sm" onclick="openCheckinEdit('morning')">âœï¸ DÃ¼zenle</button>
    </div>
    <div class="slbl">Enerji Seviyeni SeÃ§</div>
    <div class="energy-row" id="energy-btns"></div>
    <div class="slbl">Rutin</div>
    <div id="morning-checklist"></div>
    <div class="slbl">GÃ¼nÃ¼n TOP 3 Ã–nceliÄŸi</div>
    <textarea class="ifield" id="top3-input" rows="3" placeholder="1. &#10;2. &#10;3. "></textarea>
    <div style="margin-top:14px"><button class="btn btn-gold" onclick="saveMorning()">Sabah Check-In Kaydet</button></div>
  </div>
  <div class="card">
    <div class="card-title">ğŸ“Œ BugÃ¼nÃ¼n Task'larÄ±</div>
    <div class="card-sub">WBS + Mind Dump'tan enerji skoruna gÃ¶re seÃ§ildi</div>
    <div id="today-tasks"><div class="loading"><div class="spin"></div><span>YÃ¼kleniyor...</span></div></div>
    <div style="margin-top:8px"><button class="btn btn-ghost btn-sm" onclick="refreshTasks()">ğŸ”„ Yeni Ã–ner</button></div>
  </div>
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
      <div class="card-title" style="margin-bottom:0">ğŸŒ™ AkÅŸam Check-In</div>
      <button class="btn btn-ghost btn-sm" onclick="openCheckinEdit('evening')">âœï¸ DÃ¼zenle</button>
    </div>
    <div class="slbl">Ã–z BakÄ±m</div>
    <div id="evening-checklist"></div>
    <div style="margin-top:12px">
      <div class="slbl">BugÃ¼nÃ¼n En Ä°yi Åeyi</div>
      <textarea class="ifield" id="win-of-day" rows="2" placeholder="BugÃ¼n iyi giden 1 ÅŸey..."></textarea>
    </div>
    <div style="margin-top:12px">
      <div class="slbl">GÃ¼ne Puan Ver (0-10)</div>
      <div class="energy-row" id="day-score-btns"></div>
    </div>
    <div style="margin-top:10px"><button class="btn btn-navy" onclick="saveEvening()">AkÅŸam Check-In Kaydet</button></div>
  </div>
</div>

<!-- SUPPLEMENT -->
<div id="tab-supplement" style="display:none">
  <div class="card">
    <div class="card-title">ğŸ’Š BugÃ¼nÃ¼n Supplementleri</div>
    <div class="card-sub" id="suppl-day-label"></div>
    <div class="wbox">âš ï¸ YaÄŸlÄ± kapsÃ¼lleri (Omega-3, D3+K2, Resveratrol) asla aÃ§ karna alma.</div>
    <div id="suppl-checklist"></div>
    <div class="suppl-all-done" id="suppl-all-done">ğŸ‰ TÃ¼m supplementler alÄ±ndÄ±! Harika!</div>
  </div>
  <div class="card">
    <div class="card-title">ğŸ“‹ HaftalÄ±k Program</div>
    <div style="font-size:13px;color:var(--gray);line-height:2">
      <b style="color:var(--navy)">Pzt-Ã‡ar (Stabil):</b> D3+K2, Omega-3, B-Complex, Resveratrol (sabah) + Kolajen+C (ara) + Creatine (Ã¶ÄŸlen) + Mg+Zinc (akÅŸam)<br>
      <b style="color:var(--navy)">PerÅŸembe (Enjeksiyon):</b> D3+K2, Omega-3, B-Complex (sabah) + Enjeksiyon+Mg (akÅŸam)<br>
      <b style="color:var(--navy)">Cuma (Hassas):</b> D3+K2, Omega-3, B-Complex (sabah) + Creatine (Ã¶ÄŸlen) + Mg (akÅŸam)<br>
      <b style="color:var(--navy)">Cmt-Pazar:</b> Normal doz
    </div>
  </div>
</div>

<!-- MIND DUMP -->
<div id="tab-minddump" style="display:none">
  <div class="card">
    <div class="card-title">ğŸ§  Mind Dump</div>
    <div class="card-sub">AklÄ±ndaki her ÅŸeyi boÅŸalt.</div>
    <textarea class="ifield" id="md-input" rows="3" placeholder="Ne aklÄ±nda takÄ±lÄ±yor?"></textarea>
    <div class="slbl">Ã–ncelik</div>
    <div class="prio-row">
      <button class="prio-btn" id="pb-hi" onclick="setPrio('high')">ğŸ”´ YÃ¼ksek</button>
      <button class="prio-btn sel-md" id="pb-md" onclick="setPrio('med')">ğŸŸ¡ Orta</button>
      <button class="prio-btn" id="pb-lo" onclick="setPrio('low')">ğŸŸ¢ DÃ¼ÅŸÃ¼k</button>
    </div>
    <div class="slbl">Ä°ÅŸ Boyutu</div>
    <div class="prio-row">
      <button class="prio-btn" id="pb-sm" onclick="setSize('small')">ğŸŸ¢ KÃ¼Ã§Ã¼k</button>
      <button class="prio-btn sel-md" id="pb-md-size" onclick="setSize('medium')">ğŸŸ¡ Orta</button>
      <button class="prio-btn" id="pb-lg" onclick="setSize('large')">ğŸ”´ BÃ¼yÃ¼k</button>
    </div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn btn-gold" onclick="addMD()">Ekle</button>
      <button class="btn btn-ghost btn-sm" onclick="addMDAsTask()">ğŸ² Task Yap</button>
    </div>
  </div>
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
      <div class="card-title" style="margin-bottom:0">Liste</div>
      <div style="display:flex;gap:5px">
        <button class="btn btn-navy btn-sm" id="mdf-all" onclick="setMDFilter('all')">Hepsi</button>
        <button class="btn btn-ghost btn-sm" id="mdf-open" onclick="setMDFilter('open')">AÃ§Ä±k</button>
        <button class="btn btn-ghost btn-sm" id="mdf-done" onclick="setMDFilter('done')">Bitti</button>
      </div>
    </div>
    <div id="md-list"><div class="loading"><div class="spin"></div></div></div>
  </div>
</div>

<!-- HABÄ°TS -->


<!-- HABÄ°TS DAILY -->
<div id="tab-habits" style="display:none">
  <div class="card">
    <div class="card-title">âœ… BugÃ¼nÃ¼n AlÄ±ÅŸkanlÄ±klarÄ±</div>
    <div class="card-sub">Her birini tamamladÄ±kÃ§a iÅŸaretle.</div>
    <div id="habits-daily-list"><div class="loading"><div class="spin"></div></div></div>
  </div>
</div>

<!-- ZÄ°NCÄ°R -->
<div id="tab-zincir" style="display:none">
  <div class="z-hero">
    <div class="z-num" id="z-streak">0</div>
    <div class="z-info">
      <div class="z-lbl">ğŸ”¥ Aktif Streak</div>
      <div class="z-sub">Ortalama Ã¼st Ã¼ste gÃ¼n</div>
      <div class="z-rec" id="z-record">En uzun: 0 gÃ¼n</div>
    </div>
  </div>
  <div id="habit-list"><div class="loading"><div class="spin"></div></div></div>
  <button class="btn btn-gold" onclick="openAddHabit()" style="margin-top:4px">+ Yeni AlÄ±ÅŸkanlÄ±k</button>
</div>

<!-- WBS -->
<div id="tab-wbs" style="display:none">
  <div class="card">
    <div class="card-title">ğŸ“‹ WBS â€” Proje Task'larÄ±</div>
    <div id="wbs-overall"></div>
  </div>
  <div id="wbs-list"><div class="loading"><div class="spin"></div></div></div>
</div>

<!-- LOG -->
<div id="tab-log" style="display:none">
  <div class="card">
    <div class="card-title">ğŸ“š Ä°Ã§erik Logu</div>
    <div class="card-sub">OkuduklarÄ±nÄ±, izlediklerini, dinlediklerini kaydet.</div>
    <div class="type-tabs">
      <button class="type-tab active" id="lt-all" onclick="setLogType('all')">Hepsi</button>
      <button class="type-tab" id="lt-book" onclick="setLogType('book')">ğŸ“– Kitap</button>
      <button class="type-tab" id="lt-article" onclick="setLogType('article')">ğŸ“° Makale</button>
      <button class="type-tab" id="lt-video" onclick="setLogType('video')">ğŸ¬ Video</button>
      <button class="type-tab" id="lt-podcast" onclick="setLogType('podcast')">ğŸ™ï¸ Podcast</button>
      <button class="type-tab" id="lt-course" onclick="setLogType('course')">ğŸ“ Kurs</button>
    </div>
    <button class="btn btn-gold" onclick="openAddLog()" style="margin-bottom:14px">+ Yeni Ekle</button>
    <div id="log-list"><div class="loading"><div class="spin"></div></div></div>
  </div>
</div>



<!-- SAÄLIK -->
<div id="tab-saglik" style="display:none">
  <div class="card">
    <div class="card-title">ğŸ GÃ¼nlÃ¼k SaÄŸlÄ±k Logu</div>
    <div class="card-sub">Yemek, uyku ve egzersiz takibi.</div>
    <div class="slbl">Tarih</div>
    <input type="date" class="ifield" id="saglik-date" style="margin-bottom:12px">
    <div class="slbl">ğŸ˜´ Uyku</div>
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:4px">
      <input type="number" class="ifield" id="saglik-sleep-h" placeholder="Saat" min="0" max="24" style="width:80px">
      <span style="font-size:13px;color:var(--gray)">saat</span>
      <input type="number" class="ifield" id="saglik-sleep-q" placeholder="Kalite 1-5" min="1" max="5" style="width:110px">
      <span style="font-size:13px;color:var(--gray)">kalite</span>
    </div>
    <div class="slbl">ğŸ‹ï¸ Egzersiz</div>
    <input class="ifield" id="saglik-exercise" placeholder="Ã¶rn: 30 dk yÃ¼rÃ¼yÃ¼ÅŸ, yoga" style="margin-bottom:8px">
    <div class="slbl">ğŸ¥— Yemekler</div>
    <textarea class="ifield" id="saglik-food" rows="2" placeholder="KahvaltÄ±, Ã¶ÄŸle, akÅŸam..."></textarea>
    <div class="slbl">ğŸ’§ Su (litre)</div>
    <input type="number" class="ifield" id="saglik-water" placeholder="Ã¶rn: 2.5" step="0.5" style="margin-bottom:8px">
    <div class="slbl">ğŸ“ Not</div>
    <textarea class="ifield" id="saglik-note" rows="2" placeholder="NasÄ±l hissettin?"></textarea>
    <div style="margin-top:14px"><button class="btn btn-gold" onclick="saveSaglik()">Kaydet</button></div>
  </div>
  <div class="card">
    <div class="card-title">ğŸ“‹ GeÃ§miÅŸ</div>
    <div id="saglik-history"><div class="loading"><div class="spin"></div></div></div>
  </div>
</div>

<!-- OPTIMAÄ°ZED LÄ°FE -->
<div id="tab-optimaized" style="display:none">
  <div class="z-hero" style="margin-bottom:14px">
    <div style="flex:1">
      <div style="font-family:'Playfair Display',serif;color:var(--gold);font-size:22px;font-weight:700">OptimAIzed Life</div>
      <div style="color:rgba(255,255,255,.6);font-size:13px;margin-top:4px">Ä°Ã§erik & BÃ¼yÃ¼me Metrikleri</div>
    </div>
    <div style="font-size:36px">âš¡</div>
  </div>
  <div class="card">
    <div class="card-title">ğŸ“Š Bu HaftanÄ±n Metrikleri</div>
    <div id="opt-metrics-view"><div class="loading"><div class="spin"></div></div></div>
  </div>
  <div class="card">
    <div class="card-title">ğŸ“ Metrikleri GÃ¼ncelle</div>
    <div class="slbl">Ä°Ã§erik Ãœretimi</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">HazÄ±rlanan iÃ§erik</div><input type="number" id="opt-prepared" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">PaylaÅŸÄ±lan iÃ§erik</div><input type="number" id="opt-published" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">Reels sayÄ±sÄ±</div><input type="number" id="opt-reels" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">Stories sayÄ±sÄ±</div><input type="number" id="opt-stories" class="ifield" placeholder="0"></div>
    </div>
    <div class="slbl">Sosyal Medya</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">TakipÃ§i sayÄ±sÄ±</div><input type="number" id="opt-followers" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">TakipÃ§i artÄ±ÅŸÄ±</div><input type="number" id="opt-follower-gain" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">Ä°zlenme</div><input type="number" id="opt-views" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">BeÄŸeni</div><input type="number" id="opt-likes" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">Kaydetme</div><input type="number" id="opt-saves" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">Reach</div><input type="number" id="opt-reach" class="ifield" placeholder="0"></div>
    </div>
    <div class="slbl">Gelir</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">SatÄ±ÅŸ adedi</div><input type="number" id="opt-sales" class="ifield" placeholder="0"></div>
      <div><div style="font-size:12px;color:var(--gray);margin-bottom:3px">Gelir (â‚¬)</div><input type="number" id="opt-revenue" class="ifield" placeholder="0" step="0.01"></div>
    </div>
    <button class="btn btn-gold" style="margin-top:14px" onclick="saveOptimAIzed()">Kaydet</button>
  </div>
  <div class="card">
    <div class="card-title">ğŸ“ˆ HaftalÄ±k GeÃ§miÅŸ</div>
    <div id="opt-history"><div class="loading"><div class="spin"></div></div></div>
  </div>
</div>

<!-- VÄ°SÄ°ON BOARD -->
<div id="tab-visionboard" style="display:none">
  <div class="card">
    <div class="card-title">ğŸŒŸ Vision Board</div>
    <div class="card-sub">Hayallerini, hedeflerini ve motivasyon gÃ¶rsellerini buraya ekle.</div>
    <div style="display:flex;gap:8px">
      <button class="btn btn-gold" onclick="document.getElementById('vb-file-input').click()" style="flex:1">ğŸ“¸ GÃ¶rsel Ekle</button>
      <button class="btn btn-ghost btn-sm" onclick="openAddVBNote()">âœï¸ Not</button>
    </div>
    <input type="file" id="vb-file-input" accept="image/*" style="display:none" onchange="uploadVBImage(event)">
  </div>
  <div id="vb-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px"></div>
</div>

<!-- KPI -->
<div id="tab-kpi" style="display:none">
  <div class="card">
    <div class="card-title">ğŸ“Š HaftalÄ±k KPI</div>
    <div class="card-sub">%70 ve Ã¼zeri = baÅŸarÄ±lÄ± hafta ğŸ‰</div>
    <div id="kpi-view"><div class="loading"><div class="spin"></div></div></div>
  </div>
  <div class="card">
    <div class="card-title">ğŸ“ KPI GÃ¼ncelle</div>
    <div id="kpi-form"></div>
    <button class="btn btn-navy" style="margin-top:12px" onclick="saveKPI()">KPI Kaydet</button>
  </div>
</div>

<!-- AYARLAR -->
<div id="tab-ayarlar" style="display:none">
  <div class="card">
    <div class="card-title">ğŸ“± Telegram Bildirimleri</div>
    <div class="setup-step"><div class="s-num">1</div><div class="s-txt">Telegram'da <code>@BotFather</code> ara â†’ tÄ±kla.</div></div>
    <div class="setup-step"><div class="s-num">2</div><div class="s-txt"><code>/newbot</code> yaz â†’ isim ver â†’ token al.</div></div>
    <div class="setup-step"><div class="s-num">3</div><div class="s-txt">Bota mesaj at. TarayÄ±cÄ±da: <code>https://api.telegram.org/bot[TOKEN]/getUpdates</code> â†’ <code>"id"</code> = Chat ID.</div></div>
    <input class="ifield2" id="tg-token" placeholder="Bot Token">
    <input class="ifield2" id="tg-chatid" placeholder="Chat ID">
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn btn-navy btn-sm" onclick="saveTG()" style="flex:1">Kaydet</button>
      <button class="btn btn-ghost btn-sm" onclick="testTG()" style="flex:1">ğŸ“¨ Test</button>
    </div>
  </div>
  <div class="card">
    <div class="card-title">â³ Geri SayÄ±m Tarihi</div>
    <div class="card-sub">Header'da gÃ¶rÃ¼nen hedef tarih.</div>
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
      <div>
        <div style="font-size:12px;color:var(--gray);margin-bottom:3px">Mevcut hedef</div>
        <div style="font-size:16px;font-weight:600;color:var(--gold)" id="countdown-current-date">1 Nisan 2026</div>
        <div style="font-size:13px;color:var(--gray)" id="countdown-days-left"></div>
      </div>
    </div>
    <div style="font-size:12px;color:var(--gray);margin-bottom:4px">Yeni hedef tarih</div>
    <input type="date" class="ifield2" id="countdown-new-date">
    <div style="margin-top:10px"><button class="btn btn-navy btn-sm" onclick="saveCountdownDate()" style="width:100%">Tarihi GÃ¼ncelle</button></div>
  </div>
    <div style="font-size:13px;color:var(--gray);line-height:2.2">ğŸŸ¢ <b>Faz 1:</b> 20 Åub â€“ 2 Mar<br>ğŸŸ¡ <b>Faz 2:</b> 3 â€“ 17 Mar<br>âœˆï¸ <b>TÃ¼rkiye:</b> 18 â€“ 24 Mar<br>ğŸ”µ <b>Faz 3:</b> 25 â€“ 31 Mar</div>
    <div style="margin-top:10px;padding:10px;background:var(--gold-l);border-radius:8px;font-size:13px;color:var(--navy);font-weight:500">ğŸ¯ Hedef: HaftalÄ±k task'larÄ±n %70'ini tamamla.</div>
  </div>
</div>

</div>

<!-- HABIT MODAL -->
<div class="modal-bg" id="habit-modal" style="display:none" onclick="closeMBg(event,'habit-modal')">
  <div class="modal">
    <div class="modal-title" id="hm-title">Yeni AlÄ±ÅŸkanlÄ±k</div>
    <div class="slbl" style="margin-top:0">Ä°kon</div>
    <div class="emoji-grid" id="emoji-grid"></div>
    <div class="slbl">Ad</div>
    <input class="ifield" id="h-name" placeholder="Ã¶rn: Meditasyon">
    <div class="slbl">AÃ§Ä±klama</div>
    <input class="ifield" id="h-desc" placeholder="Ã¶rn: 10 dk sabah meditasyonu" style="margin-top:6px">
    <div class="slbl">Numerik Hedef (opsiyonel)</div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:6px">
      <div>
        <div style="font-size:11px;color:var(--gray);margin-bottom:3px">Hedef DeÄŸer</div>
        <input class="ifield" id="h-target" type="number" placeholder="2.5" step="0.5" min="0">
      </div>
      <div>
        <div style="font-size:11px;color:var(--gray);margin-bottom:3px">Birim</div>
        <input class="ifield" id="h-unit" placeholder="litre / dk">
      </div>
      <div>
        <div style="font-size:11px;color:var(--gray);margin-bottom:3px">AdÄ±m</div>
        <input class="ifield" id="h-step" type="number" placeholder="0.5" step="0.1" min="0.1">
      </div>
    </div>
    <div style="font-size:11px;color:var(--gray);margin-top:4px">BoÅŸ bÄ±rakÄ±rsan normal tick alÄ±ÅŸkanlÄ±ÄŸÄ± olur.</div>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button class="btn btn-gold" onclick="saveHabit()" id="h-save-btn" style="flex:1">Kaydet</button>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('habit-modal')" style="flex:0.4">Ä°ptal</button>
    </div>
    <button class="btn btn-red btn-sm" id="h-del-btn" style="display:none;width:100%;margin-top:8px" onclick="deleteHabit()">AlÄ±ÅŸkanlÄ±ÄŸÄ± Sil</button>
  </div>
</div>

<!-- LOG MODAL -->
<div class="modal-bg" id="log-modal" style="display:none" onclick="closeMBg(event,'log-modal')">
  <div class="modal">
    <div class="modal-title">Ä°Ã§erik Ekle</div>
    <div class="slbl" style="margin-top:0">TÃ¼r</div>
    <div class="type-tabs" id="log-type-select">
      <button class="type-tab active" onclick="setNewLogType('book',this)">ğŸ“– Kitap</button>
      <button class="type-tab" onclick="setNewLogType('article',this)">ğŸ“° Makale</button>
      <button class="type-tab" onclick="setNewLogType('video',this)">ğŸ¬ Video</button>
      <button class="type-tab" onclick="setNewLogType('podcast',this)">ğŸ™ï¸ Podcast</button>
      <button class="type-tab" onclick="setNewLogType('course',this)">ğŸ“ Kurs</button>
    </div>
    <div class="slbl">BaÅŸlÄ±k / Ad</div>
    <input class="ifield" id="log-title-input" placeholder="Ã¶rn: Atomic Habits">
    <div class="slbl">Yazar / Kaynak</div>
    <input class="ifield" id="log-author-input" placeholder="Ã¶rn: James Clear" style="margin-top:6px">
    <div class="slbl">Puan (1-5)</div>
    <div class="rating-row" id="log-rating-row"></div>
    <div class="slbl">Not</div>
    <textarea class="ifield" id="log-note-input" rows="2" placeholder="En Ã¶nemli Ã§Ä±karÄ±m..." style="margin-top:6px"></textarea>
    <div class="slbl">Durum</div>
    <div style="display:flex;gap:8px;margin-top:6px">
      <button class="type-tab active" id="ls-reading" onclick="setLogStatus('reading',this)">ğŸ“– Devam ediyor</button>
      <button class="type-tab" id="ls-done" onclick="setLogStatus('done',this)">âœ… TamamlandÄ±</button>
      <button class="type-tab" id="ls-want" onclick="setLogStatus('want',this)">ğŸ”– Listede</button>
    </div>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button class="btn btn-gold" onclick="saveLog()" style="flex:1">Kaydet</button>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('log-modal')" style="flex:0.4">Ä°ptal</button>
    </div>
  </div>
</div>

<!-- CHECK-IN EDIT MODAL -->
<div class="modal-bg" id="checkin-modal" style="display:none" onclick="closeMBg(event,'checkin-modal')">
  <div class="modal">
    <div class="modal-title" id="ci-modal-title">Check-In DÃ¼zenle</div>
    <div class="card-sub">SÃ¼rÃ¼kleyerek sÄ±ralayabilirsin. Sil butonuyla kaldÄ±rabilirsin.</div>
    <div id="ci-edit-list"></div>
    <button class="btn btn-ghost" onclick="addCheckinItem()" style="margin-top:8px">+ Madde Ekle</button>
    <div style="display:flex;gap:8px;margin-top:14px">
      <button class="btn btn-gold" onclick="saveCheckinItems()" style="flex:1">Kaydet</button>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('checkin-modal')" style="flex:0.4">Ä°ptal</button>
    </div>
  </div>
</div>



<!-- VÄ°SÄ°ON BOARD NOT MODAL -->
<div class="modal-bg" id="vb-note-modal" style="display:none" onclick="closeMBg(event,'vb-note-modal')">
  <div class="modal">
    <div class="modal-title">Not / Hedef Ekle</div>
    <textarea class="ifield" id="vb-note-text" rows="3" placeholder="Hedefin, motivasyon cÃ¼mlesi, affirmation..."></textarea>
    <div class="slbl">Renk</div>
    <div style="display:flex;gap:8px;margin-top:6px" id="vb-color-picker">
      <div onclick="selVBColor('#F5EDD6')" style="width:32px;height:32px;border-radius:8px;background:#F5EDD6;border:2px solid var(--gold);cursor:pointer"></div>
      <div onclick="selVBColor('#EAF4EA')" style="width:32px;height:32px;border-radius:8px;background:#EAF4EA;border:2px solid transparent;cursor:pointer"></div>
      <div onclick="selVBColor('#FFF3CD')" style="width:32px;height:32px;border-radius:8px;background:#FFF3CD;border:2px solid transparent;cursor:pointer"></div>
      <div onclick="selVBColor('#F3F4F6')" style="width:32px;height:32px;border-radius:8px;background:#F3F4F6;border:2px solid transparent;cursor:pointer"></div>
      <div onclick="selVBColor('#1B2A4A')" style="width:32px;height:32px;border-radius:8px;background:#1B2A4A;border:2px solid transparent;cursor:pointer"></div>
    </div>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button class="btn btn-gold" onclick="saveVBNote()" style="flex:1">Ekle</button>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('vb-note-modal')" style="flex:0.4">Ä°ptal</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const SURL='https://ucwgkduvpnklfggleupb.supabase.co';
const SKEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjd2drZHV2cG5rbGZnZ2xldXBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MDE1NzcsImV4cCI6MjA4NzE3NzU3N30.AKBjKoYp2xie6qd19crJVMIJDFzmXPTqU2BTtFHnypw';
const sb=supabase.createClient(SURL,SKEY);

const TABS=['bugun','supplement','minddump','habits','zincir','wbs','log','saglik','optimaized','visionboard','kpi','ayarlar'];
const EMOJIS=['ğŸ’§','ğŸ’Š','ğŸ“–','ğŸ““','âœ¨','ğŸš¿','ğŸ¦·','ğŸƒ','ğŸ§˜','ğŸ¥—','ğŸŒ¿','ğŸ’ª','â˜•','ğŸ¯','ğŸ“š','âœï¸','ğŸ¸','ğŸ–¥ï¸','ğŸ§¹','ğŸ’¤','ğŸ§´','ğŸ’†','ğŸ‹ï¸','ğŸ¨'];
const DN=['Pazar','Pazartesi','SalÄ±','Ã‡arÅŸamba','PerÅŸembe','Cuma','Cumartesi'];
const MN=['Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];
const DS=['Pz','Pt','Sa','Ã‡a','Pe','Cu','Ct'];
const DEADLINE_KEY = 'lockin_deadline';
function getDeadline() {
  const saved = localStorage.getItem(DEADLINE_KEY);
  return saved ? new Date(saved) : new Date('2026-04-01T00:00:00');
}
const LOG_ICONS={book:'ğŸ“–',article:'ğŸ“°',video:'ğŸ¬',podcast:'ğŸ™ï¸',course:'ğŸ“'};

function getToday(){const d=new Date();return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');}
let TODAY=getToday();
let energy=0;
let editHabitId=null,selEmoji=EMOJIS[0];
let mdPrio='med',mdFilter='all',mdSize='medium',dayScore=0;
let newLogType='book',logStatus='reading',logRating=0;
let editCheckinType=null;

// DEFAULT CHECK-IN ITEMS stored in localStorage + Supabase
const DEFAULT_MORNING=[
  {key:'water',label:'ğŸ’§ 1 bardak su iÃ§tim'},
  {key:'affirmations',label:'âœ¨ AffirmationlarÄ±mÄ± okudum'},
  {key:'journaling',label:'ğŸ““ Journaling yaptÄ±m'},
  {key:'reading',label:'ğŸ“– Hollandaca okuma (15 dk)'},
  {key:'supplement',label:'ğŸ’Š Sabah supplementlerimi aldÄ±m'},
];
const DEFAULT_EVENING=[
  {key:'teeth',label:'ğŸ¦· DiÅŸ fÄ±rÃ§aladÄ±m'},
  {key:'shower',label:'ğŸš¿ DuÅŸ aldÄ±m'},
];

let morningItems=JSON.parse(localStorage.getItem('morningItems')||JSON.stringify(DEFAULT_MORNING));
let eveningItems=JSON.parse(localStorage.getItem('eveningItems')||JSON.stringify(DEFAULT_EVENING));
let morningChecks={};
let eveningChecks={};

// SUPPLEMENT DATA
const SUPPL_PLANS={
  0:[{n:'D3+K2, Omega-3, B-Complex, Resveratrol',t:'Sabah (yemekle)',note:'YaÄŸlÄ± kapsÃ¼ller'},{n:'Kolajen + C vitamini',t:'Ara Ã¶ÄŸÃ¼n',note:''},{n:'Creatine 3g',t:'Ã–ÄŸlen',note:'BÃ¼yÃ¼k bardak suyla'},{n:'Magnesium + Zinc',t:'AkÅŸam',note:'Yemekle'}],
  1:[{n:'D3+K2, Omega-3, B-Complex, Resveratrol',t:'Sabah (yemekle)',note:'YaÄŸlÄ± kapsÃ¼ller'},{n:'Kolajen + C vitamini',t:'Ara Ã¶ÄŸÃ¼n',note:''},{n:'Creatine 3g',t:'Ã–ÄŸlen',note:''},{n:'Magnesium + Zinc',t:'AkÅŸam',note:''}],
  2:[{n:'D3+K2, Omega-3, B-Complex, Resveratrol',t:'Sabah (yemekle)',note:''},{n:'Kolajen + C vitamini',t:'Ara Ã¶ÄŸÃ¼n',note:''},{n:'Creatine 3g',t:'Ã–ÄŸlen',note:''},{n:'Magnesium + Zinc',t:'AkÅŸam',note:''}],
  3:[{n:'D3+K2, Omega-3, B-Complex, Resveratrol',t:'Sabah (yemekle)',note:''},{n:'Kolajen + C vitamini',t:'Ara Ã¶ÄŸÃ¼n',note:''},{n:'Creatine 3g',t:'Ã–ÄŸlen',note:''},{n:'Magnesium + Zinc',t:'AkÅŸam',note:''}],
  4:[{n:'D3+K2, Omega-3, B-Complex',t:'Sabah',note:'âš ï¸ Resveratrol isteÄŸe baÄŸlÄ±'},{n:'Enjeksiyon + Magnesium',t:'AkÅŸam',note:'Zinc atlanabilir'}],
  5:[{n:'D3+K2, Omega-3, B-Complex',t:'Sabah',note:'ğŸ”´ En hassas gÃ¼n'},{n:'Creatine (kÃ¼Ã§Ã¼k doz)',t:'Ã–ÄŸlen',note:''},{n:'Magnesium',t:'AkÅŸam',note:'Zinc atla'}],
  6:[{n:'D3+K2, Omega-3, B-Complex',t:'Sabah',note:''},{n:'Kolajen + Creatine',t:'GÃ¼n iÃ§i',note:'BÃ¶lerek al'},{n:'Magnesium + Zinc',t:'AkÅŸam',note:''}],
};

window.addEventListener('DOMContentLoaded',async()=>{
  initHeader();
  renderEnergyBtns();
  renderDayScoreBtns();
  // Restore persisted checks
  const savedMC=localStorage.getItem('morningChecks_'+TODAY);
  if(savedMC)morningChecks=JSON.parse(savedMC);
  const savedEC=localStorage.getItem('eveningChecks_'+TODAY);
  if(savedEC)eveningChecks=JSON.parse(savedEC);
  renderMorningChecklist();
  renderEveningChecklist();
  renderSupplementChecklist();
  renderKPIForm();
  renderLogRatingRow();
  await loadTodayCheckin();
  await loadTodayTasks();
  await calcStreak();
  await loadHeaderProgress();
});

// â”€â”€ HEADER â”€â”€
function initHeader(){
  updateDate();startClock();updateCountdown();setInterval(updateCountdown,60000);
}
function updateDate(){
  const n=new Date();
  document.getElementById('hdr-date').textContent=DN[n.getDay()]+', '+n.getDate()+' '+MN[n.getMonth()]+' '+n.getFullYear();
}
function startClock(){
  function tick(){
    const n=new Date();
    document.getElementById('hdr-clock').textContent=String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0')+':'+String(n.getSeconds()).padStart(2,'0');
    TODAY=getToday();
  }
  tick();setInterval(tick,1000);
}
function updateCountdown(){
  const diff=Math.ceil((getDeadline()-new Date())/(1000*60*60*24));
  document.getElementById('hdr-days').textContent=diff>0?diff:'0';
}
async function loadHeaderProgress(){
  try{
    const{data:cats}=await sb.from('wbs_categories').select('*, wbs_tasks(*, wbs_microtasks(*))');
    if(!cats)return;
    let total=0,done=0;
    cats.forEach(c=>(c.wbs_tasks||[]).forEach(t=>(t.wbs_microtasks||[]).forEach(m=>{total++;if(m.is_completed)done++;})));
    const pct=total?Math.round(done/total*100):0;
    document.getElementById('hdr-prog-fill').style.width=pct+'%';
    document.getElementById('hdr-prog-pct').textContent='%'+pct;
  }catch(e){}
}

// â”€â”€ TAB â”€â”€
function showTab(name){
  TABS.forEach(t=>document.getElementById('tab-'+t).style.display=t===name?'block':'none');
  document.querySelectorAll('.nb').forEach((b,i)=>b.classList.toggle('active',TABS[i]===name));
  if(name==='wbs')loadWBS();
  if(name==='habits')loadHabitsDaily();
  if(name==='habits')loadHabitsDaily();
  if(name==='zincir')loadHabits();
  if(name==='supplement')renderSupplementChecklist();
  if(name==='kpi')loadKPI();
  if(name==='ayarlar')loadTGSettings();
  if(name==='minddump')loadMindDump();
  if(name==='log')loadLog();
  if(name==='saglik')loadSaglik();
  if(name==='optimaized')loadOptimAIzed();
  if(name==='visionboard')loadVisionBoard();
}

// â”€â”€ ENERGY â”€â”€
function renderEnergyBtns(){
  const w=document.getElementById('energy-btns');w.innerHTML='';
  for(let i=1;i<=10;i++){
    const b=document.createElement('button');
    b.className='ebtn';b.textContent=i;
    b.onclick=()=>{energy=i;document.querySelectorAll('.ebtn').forEach((x,j)=>x.classList.toggle('active',j+1===i));};
    w.appendChild(b);
  }
}

function renderDayScoreBtns(){
  const w=document.getElementById('day-score-btns');
  if(!w)return;
  w.innerHTML='';
  for(let i=0;i<=10;i++){
    const b=document.createElement('button');
    b.className='ebtn'+(i===dayScore?' active':'');
    b.textContent=i;
    b.onclick=()=>{dayScore=i;renderDayScoreBtns();};
    w.appendChild(b);
  }
}

// â”€â”€ DYNAMIC CHECK-IN LISTS â”€â”€
function renderMorningChecklist(){
  const el=document.getElementById('morning-checklist');
  el.innerHTML=morningItems.map((item,i)=>`
    <div class="ci" onclick="toggleMorning(${i})">
      <div class="cb ${morningChecks[item.key]?'done':''}">${morningChecks[item.key]?'âœ“':''}</div>
      <span class="cl ${morningChecks[item.key]?'done':''}">${item.label}</span>
    </div>`).join('');
}
function toggleMorning(i){
  const key=morningItems[i].key;
  morningChecks[key]=!morningChecks[key];
  localStorage.setItem('morningChecks_'+TODAY, JSON.stringify(morningChecks));
  renderMorningChecklist();
}

function renderEveningChecklist(){
  const el=document.getElementById('evening-checklist');
  el.innerHTML=eveningItems.map((item,i)=>`
    <div class="ci" onclick="toggleEvening(${i})">
      <div class="cb ${eveningChecks[item.key]?'done':''}">${eveningChecks[item.key]?'âœ“':''}</div>
      <span class="cl ${eveningChecks[item.key]?'done':''}">${item.label}</span>
    </div>`).join('');
}
function toggleEvening(i){
  const key=eveningItems[i].key;
  eveningChecks[key]=!eveningChecks[key];
  localStorage.setItem('eveningChecks_'+TODAY, JSON.stringify(eveningChecks));
  renderEveningChecklist();
}

// â”€â”€ CHECK-IN EDIT â”€â”€
function openCheckinEdit(type){
  editCheckinType=type;
  document.getElementById('ci-modal-title').textContent=type==='morning'?'Sabah Rutini DÃ¼zenle':'AkÅŸam Rutini DÃ¼zenle';
  const items=type==='morning'?morningItems:eveningItems;
  renderCheckinEditList(items);
  document.getElementById('checkin-modal').style.display='flex';
}

function renderCheckinEditList(items){
  const el=document.getElementById('ci-edit-list');
  el.innerHTML=items.map((item,i)=>`
    <div class="checkin-edit-item" data-index="${i}">
      <span style="font-size:16px;cursor:grab">â˜°</span>
      <input type="text" value="${item.label}" onchange="updateCheckinLabel(${i},this.value)">
      <button class="del-item-btn" onclick="removeCheckinItem(${i})">âœ•</button>
    </div>`).join('');
}

function updateCheckinLabel(i,val){
  if(editCheckinType==='morning')morningItems[i].label=val;
  else eveningItems[i].label=val;
}

function addCheckinItem(){
  const newKey='item_'+Date.now();
  if(editCheckinType==='morning'){
    morningItems.push({key:newKey,label:'Yeni madde'});
    renderCheckinEditList(morningItems);
  }else{
    eveningItems.push({key:newKey,label:'Yeni madde'});
    renderCheckinEditList(eveningItems);
  }
}

function removeCheckinItem(i){
  if(editCheckinType==='morning'){morningItems.splice(i,1);renderCheckinEditList(morningItems);}
  else{eveningItems.splice(i,1);renderCheckinEditList(eveningItems);}
}

function saveCheckinItems(){
  if(editCheckinType==='morning'){
    localStorage.setItem('morningItems',JSON.stringify(morningItems));
    renderMorningChecklist();
  }else{
    localStorage.setItem('eveningItems',JSON.stringify(eveningItems));
    renderEveningChecklist();
  }
  closeModal('checkin-modal');
  toast('Rutin gÃ¼ncellendi!');
}

// â”€â”€ SUPPLEMENT CHECKLIST â”€â”€
function renderSupplementChecklist(){
  const day=new Date().getDay();
  const items=SUPPL_PLANS[day]||SUPPL_PLANS[1];
  const typeLabel={0:'Pazar â€” Normal',1:'Pazartesi â€” Stabil âœ…',2:'SalÄ± â€” Stabil âœ…',3:'Ã‡arÅŸamba â€” Stabil âœ…',4:'PerÅŸembe â€” Enjeksiyon âš ï¸',5:'Cuma â€” Hassas ğŸ”´',6:'Cumartesi â€” Normal'};
  document.getElementById('suppl-day-label').textContent=typeLabel[day]||'';
  const saved=JSON.parse(localStorage.getItem('suppl_checks_'+TODAY)||'{}');
  let html='';
  items.forEach((item,i)=>{
    const done=saved[i]||false;
    html+=`<div class="suppl-check-item" onclick="toggleSuppl(${i})">
      <div class="suppl-cb ${done?'done':''}">${done?'âœ“':''}</div>
      <div class="suppl-item-info">
        <div class="suppl-item-name">${item.n}</div>
        <div class="suppl-item-note">${item.t}${item.note?' Â· '+item.note:''}</div>
      </div>
    </div>`;
  });
  document.getElementById('suppl-checklist').innerHTML=html;
  checkSupplAll(items.length,saved);
}

function toggleSuppl(i){
  const day=new Date().getDay();
  const items=SUPPL_PLANS[day]||SUPPL_PLANS[1];
  const saved=JSON.parse(localStorage.getItem('suppl_checks_'+TODAY)||'{}');
  saved[i]=!saved[i];
  localStorage.setItem('suppl_checks_'+TODAY,JSON.stringify(saved));
  renderSupplementChecklist();
  checkSupplAll(items.length,saved);
}

async function checkSupplAll(total,saved){
  const doneCount=Object.values(saved).filter(Boolean).length;
  const allDone=doneCount>=total;
  document.getElementById('suppl-all-done').style.display=allDone?'block':'none';
  if(allDone){
    // Auto-tick the "supplement" habit
    try{
      const{data:habits}=await sb.from('habits').select('id,name').ilike('name','%supplement%').limit(1);
      if(habits&&habits.length){
        await sb.from('habit_logs').upsert({habit_id:habits[0].id,date:TODAY},{onConflict:'habit_id,date'});
        toast('ğŸ’Š TÃ¼m supplementler tamam! Habit otomatik iÅŸaretlendi ğŸ‰');
      }else{
        toast('ğŸ’Š TÃ¼m supplementler tamam! ğŸ‰');
      }
    }catch(e){toast('ğŸ’Š TÃ¼m supplementler tamam! ğŸ‰');}
  }
}

// â”€â”€ CHECKIN â”€â”€
async function loadTodayCheckin(){
  try{
    const{data}=await sb.from('daily_checkins').select('*').eq('date',TODAY);
    if(!data||!data.length)return;
    const m=data.find(d=>d.type==='morning');
    if(m){
      document.getElementById('card-morning').style.display='none';
      document.getElementById('cel-morning').style.display='block';
      energy=m.energy_score||0;
    }
    const e=data.find(d=>d.type==='evening');
    if(e){
      if(e.win_of_day)document.getElementById('win-of-day').value=e.win_of_day;
      if(e.day_score!=null){dayScore=e.day_score;renderDayScoreBtns();}
      // Make evening readonly since already submitted
      setTimeout(()=>{
        document.querySelectorAll('#evening-checklist .ci').forEach(el=>{el.style.pointerEvents='none';el.style.opacity='.7';});
        const wod=document.getElementById('win-of-day');if(wod){wod.readOnly=true;wod.style.opacity='.7';}
        document.querySelectorAll('#day-score-btns .ebtn').forEach(b=>b.disabled=true);
      },300);
    }
    if(m&&m.top3){
      document.getElementById('top3-input').value=m.top3;
      const t3el=document.getElementById('cel-top3');
      if(t3el){t3el.textContent=m.top3;document.getElementById('cel-top3-wrap').style.display='block';}
    }
  }catch(e){}
}

async function saveMorning(){
  if(!energy){toast('Enerji skorunu seÃ§!');return;}
  const checks={};
  morningItems.forEach(item=>{checks[item.key+'_done']=morningChecks[item.key]||false;});
  try{
    const top3=document.getElementById('top3-input').value.trim();
    await sb.from('daily_checkins').upsert({
      date:TODAY,type:'morning',energy_score:energy,
      water_done:morningChecks['water']||false,
      affirmations_done:morningChecks['affirmations']||false,
      journaling_done:morningChecks['journaling']||false,
      reading_done:morningChecks['reading']||false,
      supplement_done:morningChecks['supplement']||false,
      top3,
    },{onConflict:'date,type'});
    toast('âœ… Sabah check-in kaydedildi!');
    document.getElementById('card-morning').style.display='none';
    document.getElementById('cel-morning').style.display='block';
    // Show saved top3 in celebrate card
    const top3val=document.getElementById('top3-input').value.trim();
    if(top3val){
      const t3el=document.getElementById('cel-top3');
      if(t3el){t3el.textContent=top3val;document.getElementById('cel-top3-wrap').style.display='block';}
    }
    await loadTodayTasks(energy);
    await calcStreak();
    sendTG('â˜€ï¸ Sabah check-in tamam! Enerji: '+energy+'/10');
  }catch(e){toast('Hata: '+e.message);}
}

async function saveEvening(){
  const win=document.getElementById('win-of-day').value;
  try{
    await sb.from('daily_checkins').upsert({
      date:TODAY,type:'evening',
      teeth_done:eveningChecks['teeth']||false,
      shower_done:eveningChecks['shower']||false,
      win_of_day:win,
      day_score:dayScore||null,
    },{onConflict:'date,type'});
    toast('ğŸŒ™ AkÅŸam check-in kaydedildi!');
    // Make evening checklist read-only
    document.querySelectorAll('#evening-checklist .ci').forEach(el=>{
      el.style.pointerEvents='none';el.style.opacity='.7';
    });
    document.getElementById('win-of-day').readOnly=true;
    document.getElementById('win-of-day').style.opacity='.7';
    document.querySelectorAll('#day-score-btns .ebtn').forEach(b=>b.disabled=true);
    sendTG('ğŸŒ™ AkÅŸam check-in tamam! En iyi ÅŸey: '+(win||'â€”'));
  }catch(e){toast('Hata: '+e.message);}
}

// â”€â”€ TODAY TASKS â”€â”€
async function loadTodayTasks(energyScore){
  const score=energyScore||energy||5;
  const el=document.getElementById('today-tasks');
  el.innerHTML='<div class="loading"><div class="spin"></div><span>YÃ¼kleniyor...</span></div>';
  try{
    const{data:existing}=await sb.from('daily_tasks').select('id,status,source,microtask_id,mind_dump_id,wbs_microtasks(title,wbs_tasks(title,wbs_categories(label)))').eq('date',TODAY);
    if(existing&&existing.length){
      const mdIds=existing.filter(t=>t.mind_dump_id).map(t=>t.mind_dump_id);
      let mdTexts={};
      if(mdIds.length){
        const{data:md}=await sb.from('mind_dump_items').select('id,text').in('id',mdIds);
        if(md)md.forEach(m=>mdTexts[m.id]=m.text);
      }
      renderTasks(existing,mdTexts);return;
    }
    const count=score<=4?1:2;
    const maxSize=score<=3?'small':score<=6?'medium':'large';
    const sizeOrder={small:1,medium:2,large:3};
    let mdQuery=sb.from('mind_dump_items').select('id,size').eq('is_done',false);
    if(maxSize==='small') mdQuery=mdQuery.eq('size','small');
    else if(maxSize==='medium') mdQuery=mdQuery.in('size',['small','medium']);
    const{data:mts}=await sb.from('wbs_microtasks').select('id,title,wbs_tasks(title,wbs_categories(label))').eq('is_completed',false).limit(10);
    const inserts=[];
    if(mts&&mts.length)inserts.push({date:TODAY,microtask_id:mts[0].id,status:'pending',source:'wbs'});
    if(count>=2){
      let added=false;
      try{const{data:mdI}=await mdQuery.limit(5);
        if(mdI&&mdI.length){inserts.push({date:TODAY,mind_dump_id:mdI[Math.floor(Math.random()*mdI.length)].id,status:'pending',source:'minddump'});added=true;}}catch(e){}
      if(!added&&mts&&mts.length>1)inserts.push({date:TODAY,microtask_id:mts[1].id,status:'pending',source:'wbs'});
    }
    for(const ins of inserts)await sb.from('daily_tasks').insert(ins);
    const{data:newT}=await sb.from('daily_tasks').select('id,status,source,microtask_id,mind_dump_id,wbs_microtasks(title,wbs_tasks(title,wbs_categories(label)))').eq('date',TODAY);
    const mdIds2=(newT||[]).filter(t=>t.mind_dump_id).map(t=>t.mind_dump_id);
    let mdTexts2={};
    if(mdIds2.length){try{const{data:md2}=await sb.from('mind_dump_items').select('id,text').in('id',mdIds2);if(md2)md2.forEach(m=>mdTexts2[m.id]=m.text);}catch(e){}}
    renderTasks(newT||[],mdTexts2);
  }catch(e){el.innerHTML='<div class="empty"><div class="empty-icon">âš ï¸</div>'+e.message+'</div>';}
}

async function refreshTasks(){
  try{await sb.from('daily_tasks').delete().eq('date',TODAY);}catch(e){}
  await loadTodayTasks(energy);
}

function renderTasks(tasks,mdTexts){
  mdTexts=mdTexts||{};
  const el=document.getElementById('today-tasks');
  if(!tasks.length){el.innerHTML='<div class="empty"><div class="empty-icon">ğŸ“Œ</div>Ã–nce sabah check-in yap</div>';return;}
  let h='';
  tasks.forEach(t=>{
    const done=t.status==='done',part=t.status==='partial',isMD=t.source==='minddump';
    const title=isMD?(mdTexts[t.mind_dump_id]||'Mind Dump Task'):((t.wbs_microtasks&&t.wbs_microtasks.title)||'â€”');
    const cat=isMD?'ğŸ§  Mind Dump':((t.wbs_microtasks&&t.wbs_microtasks.wbs_tasks&&t.wbs_microtasks.wbs_tasks.wbs_categories&&t.wbs_microtasks.wbs_tasks.wbs_categories.label)||'');
    const micId=t.microtask_id||'',mdId=t.mind_dump_id||'';
    h+='<div class="task-item'+(done?' done':'')+'" onclick="cycleTask(\''+t.id+'\',\''+t.status+'\',\''+t.source+'\',\''+micId+'\',\''+mdId+'\')">'
      +'<div class="task-check'+(done?' done':'')+'">'+( done?'âœ“':'')+'</div>'
      +'<div class="task-info"><div class="task-title">'+title+'</div><div class="task-cat">'+cat+'</div></div>'
      +'<span class="badge '+(done?'b-done':part?'b-part':'b-pend')+'">'+(done?'âœ“ Bitti':part?'~ KÄ±smen':'Bekliyor')+'</span></div>';
  });
  el.innerHTML=h;
}

async function cycleTask(id,status,source,micId,mdId){
  const next=status==='pending'?'done':status==='done'?'partial':'pending';
  try{
    await sb.from('daily_tasks').update({status:next}).eq('id',id);
    if(next==='done'){
      if(source==='wbs'&&micId&&micId!=='null'&&micId!==''){
        await sb.from('wbs_microtasks').update({is_completed:true,completed_at:new Date().toISOString()}).eq('id',micId);
        await loadHeaderProgress();
      }
      if(source==='minddump'&&mdId&&mdId!=='null'&&mdId!==''){
        try{await sb.from('mind_dump_items').update({is_done:true}).eq('id',mdId);}catch(e){}
      }
      toast('âœ… Task tamamlandÄ±!');
    }
    await loadTodayTasks(energy);
  }catch(e){toast('Hata: '+e.message);}
}

// â”€â”€ MIND DUMP â”€â”€
function setPrio(p){
  mdPrio=p;
  document.getElementById('pb-hi').className='prio-btn'+(p==='high'?' sel-hi':'');
  document.getElementById('pb-md').className='prio-btn'+(p==='med'?' sel-md':'');
  document.getElementById('pb-lo').className='prio-btn'+(p==='low'?' sel-lo':'');
}
function setSize(s){
  mdSize=s;
  document.getElementById('pb-sm').className='prio-btn'+(s==='small'?' sel-lo':'');
  document.getElementById('pb-md-size').className='prio-btn'+(s==='medium'?' sel-md':'');
  document.getElementById('pb-lg').className='prio-btn'+(s==='large'?' sel-hi':'');
}
async function addMD(){
  const text=document.getElementById('md-input').value.trim();
  if(!text){toast('Bir ÅŸeyler yaz!');return;}
  try{await sb.from('mind_dump_items').insert({text,priority:mdPrio,size:mdSize,is_done:false});document.getElementById('md-input').value='';toast('Mind dump eklendi!');await loadMindDump();}catch(e){toast('Hata: '+e.message);}
}
async function addMDAsTask(){
  const text=document.getElementById('md-input').value.trim();
  if(!text){toast('Ã–nce bir ÅŸeyler yaz!');return;}
  try{
    const{data:item}=await sb.from('mind_dump_items').insert({text,priority:mdPrio,size:mdSize,is_done:false}).select().single();
    if(item){await sb.from('daily_tasks').insert({date:TODAY,mind_dump_id:item.id,status:'pending',source:'minddump'});document.getElementById('md-input').value='';toast('BugÃ¼nÃ¼n task\'Ä±na eklendi!');await loadMindDump();await loadTodayTasks(energy);}
  }catch(e){toast('Hata: '+e.message);}
}
function setMDFilter(f){
  mdFilter=f;
  ['all','open','done'].forEach(x=>document.getElementById('mdf-'+x).className='btn btn-'+(x===f?'navy':'ghost')+' btn-sm');
  loadMindDump();
}
async function loadMindDump(){
  try{
    const{data}=await sb.from('mind_dump_items').select('*').order('created_at',{ascending:false});
    if(!data)return;
    let items=data;
    if(mdFilter==='open')items=data.filter(d=>!d.is_done);
    if(mdFilter==='done')items=data.filter(d=>d.is_done);
    const el=document.getElementById('md-list');
    if(!items.length){el.innerHTML='<div class="empty"><div class="empty-icon">ğŸ§ </div>HenÃ¼z hiÃ§bir ÅŸey yok.</div>';return;}
    const pM={high:'ğŸ”´ YÃ¼ksek',med:'ğŸŸ¡ Orta',low:'ğŸŸ¢ DÃ¼ÅŸÃ¼k'};
    const sM={small:'ğŸŸ¢ KÃ¼Ã§Ã¼k',medium:'ğŸŸ¡ Orta',large:'ğŸ”´ BÃ¼yÃ¼k'};
    const pC={high:'md-prio p-hi',med:'md-prio p-md',low:'md-prio p-lo'};
    let h='';
    items.forEach(item=>{
      h+='<div class="md-item'+(item.is_done?' done':'')+'"><div class="md-text'+(item.is_done?' done':'')+'">'+item.text+'</div>'
        +'<div style="display:flex;align-items:center;gap:5px;flex-shrink:0">'
        +(item.priority?'<span class="'+(pC[item.priority]||'md-prio')+'">'+( pM[item.priority]||'')+'</span>':'')
        +(item.size?'<span style="font-size:10px;font-weight:600;padding:2px 7px;border-radius:99px;background:var(--gray-l);color:var(--gray)">'+(sM[item.size]||'')+'</span>':'')
        +'<button class="md-btn" onclick="toggleMD(\''+item.id+'\','+item.is_done+')">'+(item.is_done?'â†©':'âœ“')+'</button>'
        +'<button class="md-btn" onclick="deleteMD(\''+item.id+'\')">âœ•</button></div></div>';
    });
    el.innerHTML=h;
  }catch(e){document.getElementById('md-list').innerHTML='<div class="empty">YÃ¼klenemedi</div>';}
}
async function toggleMD(id,isDone){await sb.from('mind_dump_items').update({is_done:!isDone}).eq('id',id);await loadMindDump();}
async function deleteMD(id){await sb.from('mind_dump_items').delete().eq('id',id);toast('Silindi');await loadMindDump();}

// â”€â”€ LOG â”€â”€
function renderLogRatingRow(){
  const row=document.getElementById('log-rating-row');
  row.innerHTML='';
  for(let i=1;i<=5;i++){
    const b=document.createElement('button');
    b.className='rating-btn'+(i<=logRating?' active':'');
    b.textContent=['1','2','3','4','5'][i-1]+'â˜…';
    const score=i;
    b.onclick=()=>{logRating=score;renderLogRatingRow();};
    row.appendChild(b);
  }
}

function setNewLogType(type,btn){
  newLogType=type;
  document.querySelectorAll('#log-type-select .type-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}
function setLogStatus(s,btn){
  logStatus=s;
  ['reading','done','want'].forEach(x=>document.getElementById('ls-'+x).classList.remove('active'));
  btn.classList.add('active');
}

function setLogType(type){
  ['all','book','article','video','podcast','course'].forEach(x=>document.getElementById('lt-'+x).className='type-tab'+(x===type?' active':''));
  loadLog(type);
}

function openAddLog(){
  logRating=0;newLogType='book';logStatus='reading';
  document.getElementById('log-title-input').value='';
  document.getElementById('log-author-input').value='';
  document.getElementById('log-note-input').value='';
  renderLogRatingRow();
  document.querySelectorAll('#log-type-select .type-tab').forEach((b,i)=>b.classList.toggle('active',i===0));
  ['reading','done','want'].forEach(x=>document.getElementById('ls-'+x).classList.toggle('active',x==='reading'));
  document.getElementById('log-modal').style.display='flex';
}

async function saveLog(){
  const title=document.getElementById('log-title-input').value.trim();
  if(!title){toast('BaÅŸlÄ±k gir!');return;}
  try{
    await sb.from('content_logs').insert({
      title,
      author:document.getElementById('log-author-input').value.trim(),
      type:newLogType,
      rating:logRating||null,
      note:document.getElementById('log-note-input').value.trim(),
      status:logStatus,
      logged_date:TODAY
    });
    closeModal('log-modal');
    toast('âœ… Kaydedildi!');
    await loadLog();
  }catch(e){toast('Hata: '+e.message);}
}

async function loadLog(filterType){
  const ft=filterType||'all';
  try{
    let q=sb.from('content_logs').select('*').order('logged_date',{ascending:false});
    if(ft!=='all')q=q.eq('type',ft);
    const{data}=await q;
    const el=document.getElementById('log-list');
    if(!data||!data.length){el.innerHTML='<div class="empty"><div class="empty-icon">ğŸ“š</div>HenÃ¼z iÃ§erik eklenmedi.</div>';return;}
    const statusLbl={reading:'ğŸ“– Devam ediyor',done:'âœ… TamamlandÄ±',want:'ğŸ”– Listede'};
    let h='';
    data.forEach(item=>{
      const stars=item.rating?'â˜…'.repeat(item.rating)+'â˜†'.repeat(5-item.rating):'';
      h+='<div class="log-item">'
        +'<div class="log-type-badge">'+(LOG_ICONS[item.type]||'ğŸ“„')+'</div>'
        +'<div class="log-info">'
        +'<div class="log-title">'+item.title+'</div>'
        +'<div class="log-meta">'+(item.author?item.author+' Â· ':'')+( statusLbl[item.status]||item.status)+(stars?' Â· <span style="color:var(--gold)">'+stars+'</span>':'')+'</div>'
        +(item.note?'<div style="font-size:12px;color:var(--gray);margin-top:3px">'+item.note+'</div>':'')
        +'</div>'
        +'<button class="log-del" onclick="deleteLog(\''+item.id+'\')">âœ•</button></div>';
    });
    el.innerHTML=h;
  }catch(e){document.getElementById('log-list').innerHTML='<div class="empty">YÃ¼klenemedi: '+e.message+'</div>';}
}
async function deleteLog(id){await sb.from('content_logs').delete().eq('id',id);toast('Silindi');await loadLog();}

// â”€â”€ HABÄ°TS DAILY â”€â”€
async function loadHabitsDaily(){
  const el=document.getElementById('habits-daily-list');
  try{
    await ensureDefaultHabits();
    const{data:habits}=await sb.from('habits').select('*').order('sort_order');
    if(!habits||!habits.length){
      el.innerHTML='<div class="empty"><div class="empty-icon">ğŸŒ±</div>HenÃ¼z alÄ±ÅŸkanlÄ±k yok.<br>Zincir sekmesinden ekle!</div>';
      return;
    }
    const{data:logs}=await sb.from('habit_logs').select('habit_id').eq('date',TODAY);
    const doneIds=new Set((logs||[]).map(l=>l.habit_id));
    const total=habits.length;
    const doneCount=habits.filter(h=>doneIds.has(h.id)).length;
    const pct=total?Math.round(doneCount/total*100):0;
    let h='<div class="pbw"><div class="pbf" style="width:'+pct+'%"></div></div>'
      +'<div class="plbl" style="margin-bottom:16px"><span>BugÃ¼n</span><span>'+doneCount+'/'+total+' (%'+pct+')</span></div>';
    habits.forEach(habit=>{
      const done=doneIds.has(habit.id);
      const hid=habit.id;
      h+='<div class="ci" style="cursor:pointer" data-hid="'+hid+'" data-done="'+done+'" onclick="tickHabitDailyEl(this)">'
        +'<div class="cb'+(done?' done':'')+'">'+(done?'âœ“':'')+'</div>'
        +'<div style="flex:1"><span class="cl'+(done?' done':'')+'">'+ habit.icon+' '+habit.name+'</span>'
        +(habit.description?'<div style="font-size:11px;color:var(--gray);margin-top:1px">'+habit.description+'</div>':'')  
        +'</div></div>';
    });
    if(doneCount===total&&total>0){
      h+='<div style="background:var(--green-l);border-radius:var(--rs);padding:12px;text-align:center;font-size:14px;font-weight:600;color:var(--green);margin-top:12px">ğŸ‰ BugÃ¼n tÃ¼m alÄ±ÅŸkanlÄ±klar tamam!</div>';
    }
    el.innerHTML=h;
  }catch(e){el.innerHTML='<div class="empty">YÃ¼klenemedi: '+e.message+'</div>';}
}

function tickHabitDailyEl(el){
  const hid=el.dataset.hid;
  const isDone=el.dataset.done==='true';
  tickHabitDaily(hid,isDone);
}

async function tickHabitDaily(hid,isDone){
  try{
    if(isDone){
      await sb.from('habit_logs').delete().eq('habit_id',hid).eq('date',TODAY);
    }else{
      await sb.from('habit_logs').upsert({habit_id:hid,date:TODAY},{onConflict:'habit_id,date'});
      toast('âœ“ YapÄ±ldÄ±!');
    }
    await loadHabitsDaily();
  }catch(e){toast('Hata: '+e.message);}
}

// â”€â”€ ZÄ°NCÄ°R â”€â”€
async function loadHabits(){
  document.getElementById('habit-list').innerHTML='<div class="loading"><div class="spin"></div></div>';
  try{
    await ensureDefaultHabits();
    const{data:habits}=await sb.from('habits').select('*').order('sort_order');
    if(!habits||!habits.length){document.getElementById('habit-list').innerHTML='<div class="empty"><div class="empty-icon">ğŸŒ±</div>HenÃ¼z alÄ±ÅŸkanlÄ±k yok.</div>';return;}
    const start=new Date();start.setDate(start.getDate()-27);
    const{data:logs}=await sb.from('habit_logs').select('habit_id,date').gte('date',start.toISOString().split('T')[0]);
    let html='',totalStreak=0,longestAll=0;
    for(const h of habits){
      const{streak,longest,days}=calcHabitStats((logs||[]).filter(l=>l.habit_id===h.id));
      totalStreak+=streak;if(longest>longestAll)longestAll=longest;
      html+=buildHabitCard(h,streak,longest,days);
    }
    document.getElementById('habit-list').innerHTML=html;
    const avg=habits.length>0?Math.round(totalStreak/habits.length):0;
    document.getElementById('z-streak').textContent=avg;
    document.getElementById('z-record').textContent='En uzun: '+longestAll+' gÃ¼n';
    document.getElementById('hdr-streak').textContent='ğŸ”¥ '+avg+' gÃ¼n';
  }catch(e){document.getElementById('habit-list').innerHTML='<div class="empty">YÃ¼klenemedi: '+e.message+'</div>';}
}
async function ensureDefaultHabits(){
  const{data}=await sb.from('habits').select('id').limit(1);
  if(data&&data.length)return;
  const defs=[{icon:'ğŸ’§',name:'Su â€” 2.5L',description:'GÃ¼nlÃ¼k hedef',sort_order:1},{icon:'ğŸ’Š',name:'Supplement',description:'Sabah protokolÃ¼',sort_order:2},{icon:'âœ¨',name:'Affirmations',description:'Sesli okuma',sort_order:3},{icon:'ğŸ““',name:'Journaling',description:'3 ÅŸÃ¼kran + niyet',sort_order:4},{icon:'ğŸ“–',name:'Hollandaca Okuma',description:'15 dk',sort_order:5},{icon:'ğŸ¦·',name:'DiÅŸ FÄ±rÃ§alama',description:'Sabah + akÅŸam',sort_order:6},{icon:'ğŸš¿',name:'DuÅŸ',description:'Haftada min 3',sort_order:7}];
  for(const d of defs)await sb.from('habits').insert(d);
}
function calcHabitStats(logs){
  const days={};logs.forEach(l=>days[l.date]=true);
  let streak=0;const d=new Date();
  for(let i=0;i<365;i++){const ds=d.toISOString().split('T')[0];if(days[ds]){streak++;d.setDate(d.getDate()-1);}else break;}
  const sorted=Object.keys(days).sort();let longest=0,cur=0,prev=null;
  sorted.forEach(ds=>{if(prev){const diff=Math.round((new Date(ds)-new Date(prev))/86400000);cur=diff===1?cur+1:1;}else{cur=1;}if(cur>longest)longest=cur;prev=ds;});
  return{streak,longest,days};
}
function buildHabitCard(h,streak,longest,days){
  const todayDone=days[TODAY]||false;
  let cal='';
  for(let i=27;i>=0;i--){
    const d=new Date();d.setDate(d.getDate()-i);
    const ds=d.toISOString().split('T')[0];
    const isT=ds===TODAY,isFut=ds>TODAY,hit=days[ds]||false;
    let cls='cal-box'+(hit?' hit':'')+(isT?' today':'')+(isFut?' fut':'');
    cal+='<div class="cal-day"><div class="'+cls+'">'+(hit?'âœ“':'')+'</div><div class="cal-lbl'+(isT?' today':'')+'">'+DS[d.getDay()]+'</div></div>';
  }
  const eid=h.id,en=h.name.replace(/'/g,'&apos;'),ed=(h.description||'').replace(/'/g,'&apos;');
  // Detect numeric habit: target_value set OR description contains a number with unit
  const hasNumeric = h.target_value != null && h.target_value > 0;
  const unit = h.target_unit || '';
  const currentVal = parseFloat(localStorage.getItem('habit_val_'+TODAY+'_'+eid)||'0');

  let actionHtml='';
  if(hasNumeric){
    actionHtml='<div class="counter-row">'
      +'<button class="cnt-btn" onclick="habitCounterAdj(''+eid+'','+h.target_value+','+h.target_step+',-1)" style="font-size:20px">âˆ’</button>'
      +'<div class="cnt-val" id="hcv-'+eid+'">'+currentVal+'</div>'
      +'<span class="cnt-unit">/ '+h.target_value+' '+unit+'</span>'
      +'<button class="cnt-btn" onclick="habitCounterAdj(''+eid+'','+h.target_value+','+h.target_step+',1)" style="background:var(--gold);border-color:var(--gold);color:var(--navy)">+</button>'
      +'</div>';
  } else {
    actionHtml='<button class="tick-btn'+(todayDone?' done':'')+'" onclick="tickHabit(''+eid+'','+todayDone+')">'+(todayDone?'âœ“':'â—‹')+'</button>';
  }

  return '<div class="h-card"><div class="h-top">'
    +'<div class="h-icon">'+h.icon+'</div>'
    +'<div class="h-info"><div class="h-name">'+h.name+'</div><div class="h-sub">'+(h.description||'')+'</div></div>'
    +'<div class="h-streak"><div class="h-s-num">'+streak+'</div><div class="h-s-lbl">streak</div></div>'
    +actionHtml
    +'<button class="edit-btn" onclick="openEditHabit(''+eid+'',''+h.icon+'',''+en+'',''+ed+'','+( h.target_value||'null')+',''+unit+'','+( h.target_step||'null')+')">âœï¸</button>'
    +'</div><div class="cal-wrap"><div class="cal-row">'+cal+'</div></div>'
    +'<div class="h-best">ğŸ† En uzun streak: '+longest+' gÃ¼n</div></div>';
}


function renderEmojiGrid(){
  document.getElementById('emoji-grid').innerHTML=EMOJIS.map(e=>'<button class="eg-btn'+(e===selEmoji?' active':'')+'" onclick="selEmojiClick(\''+e+'\')">'+e+'</button>').join('');
}
function selEmojiClick(e){selEmoji=e;renderEmojiGrid();}
function openAddHabit(){
  editHabitId=null;selEmoji=EMOJIS[0];
  document.getElementById('hm-title').textContent='Yeni AlÄ±ÅŸkanlÄ±k';
  document.getElementById('h-name').value='';
  document.getElementById('h-desc').value='';
  document.getElementById('h-target').value='';
  document.getElementById('h-unit').value='';
  document.getElementById('h-step').value='';
  document.getElementById('h-del-btn').style.display='none';
  document.getElementById('h-save-btn').textContent='Kaydet';
  renderEmojiGrid();document.getElementById('habit-modal').style.display='flex';
}
function openEditHabit(id,icon,name,desc,targetVal,unit,step){
  editHabitId=id;selEmoji=icon;
  document.getElementById('hm-title').textContent='DÃ¼zenle';
  document.getElementById('h-name').value=name;
  document.getElementById('h-desc').value=desc;
  document.getElementById('h-target').value=targetVal&&targetVal!='null'?targetVal:'';
  document.getElementById('h-unit').value=unit&&unit!='null'?unit:'';
  document.getElementById('h-step').value=step&&step!='null'?step:'';
  document.getElementById('h-del-btn').style.display='block';
  document.getElementById('h-save-btn').textContent='GÃ¼ncelle';
  renderEmojiGrid();document.getElementById('habit-modal').style.display='flex';
}
function habitCounterAdj(hid, target, step, dir){
  const stepVal = parseFloat(step) || 0.5;
  const key = 'habit_val_'+TODAY+'_'+hid;
  let val = parseFloat(localStorage.getItem(key)||'0');
  val = Math.max(0, Math.round((val + dir * stepVal) * 100) / 100); // no negatives
  localStorage.setItem(key, val);
  const el = document.getElementById('hcv-'+hid);
  if(el) el.textContent = val;
  // If reached target, auto-tick
  if(val >= target){
    sb.from('habit_logs').upsert({habit_id:hid,date:TODAY},{onConflict:'habit_id,date'})
      .then(()=>{ loadHabits(); toast('ğŸ¯ Hedef tamamlandÄ±!'); });
  } else {
    // Remove tick if went below target
    sb.from('habit_logs').delete().eq('habit_id',hid).eq('date',TODAY).then(()=>{
      const card = document.getElementById('hcv-'+hid);
      if(card){ const h=card.closest('.h-card'); if(h){ const num=h.querySelector('.h-s-num'); } }
    });
  }
}

async function saveHabit(){
  const name=document.getElementById('h-name').value.trim();
  if(!name){toast('Ad gir!');return;}
  const desc=document.getElementById('h-desc').value.trim();
  try{
    const targetVal=parseFloat(document.getElementById('h-target').value)||null;
    const unitVal=document.getElementById('h-unit').value.trim();
    const stepVal=parseFloat(document.getElementById('h-step').value)||null;
    if(editHabitId){
      await sb.from('habits').update({icon:selEmoji,name,description:desc,target_value:targetVal,target_unit:unitVal,target_step:stepVal}).eq('id',editHabitId);
      toast('GÃ¼ncellendi!');
    } else {
      const{data:ex}=await sb.from('habits').select('sort_order').order('sort_order',{ascending:false}).limit(1);
      await sb.from('habits').insert({icon:selEmoji,name,description:desc,sort_order:((ex&&ex.length?ex[0].sort_order:0)+1),target_value:targetVal,target_unit:unitVal,target_step:stepVal});
      toast('Eklendi!');
    }
    closeModal('habit-modal');await loadHabits();
  }catch(e){toast('Hata: '+e.message);}
}
async function deleteHabit(){
  if(!editHabitId)return;
  if(!confirm('Silmek istediÄŸine emin misin?'))return;
  try{await sb.from('habit_logs').delete().eq('habit_id',editHabitId);await sb.from('habits').delete().eq('id',editHabitId);closeModal('habit-modal');toast('Silindi');await loadHabits();}catch(e){toast('Hata: '+e.message);}
}

// â”€â”€ WBS â”€â”€
async function loadWBS(){
  try{
    const{data:cats}=await sb.from('wbs_categories').select('*, wbs_tasks(*, wbs_microtasks(*))').order('sort_order');
    if(!cats)return;
    let total=0,done=0;
    cats.forEach(c=>(c.wbs_tasks||[]).forEach(t=>(t.wbs_microtasks||[]).forEach(m=>{total++;if(m.is_completed)done++;})));
    const pct=total?Math.round(done/total*100):0;
    document.getElementById('wbs-overall').innerHTML='<div class="pbw"><div class="pbf" style="width:'+pct+'%"></div></div><div class="plbl"><span>Genel ilerleme</span><span>'+done+'/'+total+' (%'+pct+')</span></div>';
    document.getElementById('hdr-prog-fill').style.width=pct+'%';
    document.getElementById('hdr-prog-pct').textContent='%'+pct;
    let html='';
    cats.forEach(cat=>{
      const tasks=cat.wbs_tasks||[];let ct=0,cd=0;
      tasks.forEach(t=>(t.wbs_microtasks||[]).forEach(m=>{ct++;if(m.is_completed)cd++;}));
      const cp=ct?Math.round(cd/ct*100):0;
      let th='';
      tasks.forEach(task=>{
        const ms=task.wbs_microtasks||[];const allDone=ms.length>0&&ms.every(m=>m.is_completed);
        let mh='';
        ms.forEach(m=>{mh+='<div class="mt-row" onclick="toggleMicro(\''+m.id+'\','+m.is_completed+')">'+'<div class="mt-check'+(m.is_completed?' done':'')+'">'+( m.is_completed?'âœ“':'')+'</div><span class="mt-lbl'+(m.is_completed?' done':'')+'">'+m.title+'</span></div>';});
        th+='<div class="task-group"><div class="wbs-task'+(allDone?' done':'')+'"><span>'+(allDone?'âœ…':'â—‹')+'</span>'+task.title+'</div>'+mh+'</div>';
      });
      html+='<div class="card"><div class="cat-hdr" onclick="toggleCat(\'wc-'+cat.id+'\')">'+'<div class="cat-name">'+cat.label+'</div><div class="cat-prog">'+cd+'/'+ct+' Â· %'+cp+'</div></div>'+'<div class="pbw"><div class="pbf" style="width:'+cp+'%"></div></div>'+'<div id="wc-'+cat.id+'" style="margin-top:8px">'+th+'</div></div>';
    });
    document.getElementById('wbs-list').innerHTML=html;
  }catch(e){document.getElementById('wbs-list').innerHTML='<div class="empty">YÃ¼klenemedi</div>';}
}
function toggleCat(id){const el=document.getElementById(id);el.style.display=el.style.display==='none'?'block':'none';}
async function toggleMicro(id,cur){
  try{await sb.from('wbs_microtasks').update({is_completed:!cur,completed_at:!cur?new Date().toISOString():null}).eq('id',id);if(!cur)toast('âœ… TamamlandÄ±!');await loadWBS();}catch(e){toast('Hata: '+e.message);}
}

// â”€â”€ KPI â”€â”€
async function loadKPI(){
  try{
    const{data}=await sb.from('weekly_kpi').select('*').eq('week_start',getMonday()).maybeSingle();
    if(!data){document.getElementById('kpi-view').innerHTML='<div class="empty"><div class="empty-icon">ğŸ“Š</div>Bu hafta henÃ¼z KPI girilmedi.</div>';return;}
    const s=data.microtask_completion_pct||0;
    document.getElementById('kpi-view').innerHTML=
      (s>=70?'<div class="celebrate" style="margin-bottom:12px"><div class="cel-icon">ğŸ‰</div><div class="cel-title">BaÅŸarÄ±lÄ± Hafta!</div><div class="cel-txt">%'+s+' tamamlandÄ±</div></div>':'')
      +'<div class="kpi-grid">'
      +'<div class="kpi-card"><div class="kpi-val">%'+s+'</div><div class="kpi-lbl">Task Tamamlama</div><div class="kpi-tgt">â‰¥%70</div></div>'
      +'<div class="kpi-card"><div class="kpi-val">'+(data.water_days||0)+'/7</div><div class="kpi-lbl">Su 2.5L</div><div class="kpi-tgt">7/7</div></div>'
      +'<div class="kpi-card"><div class="kpi-val">%'+(data.supplement_pct||0)+'</div><div class="kpi-lbl">Supplement</div><div class="kpi-tgt">â‰¥%80</div></div>'
      +'<div class="kpi-card"><div class="kpi-val">'+(data.reels_published||0)+'</div><div class="kpi-lbl">Reels</div><div class="kpi-tgt">3/hafta</div></div>'
      +'<div class="kpi-card"><div class="kpi-val">'+(data.ig_reach_change||0)+'%</div><div class="kpi-lbl">IG Reach</div><div class="kpi-tgt">>%20</div></div>'
      +'<div class="kpi-card"><div class="kpi-val">'+(data.ig_saves||0)+'</div><div class="kpi-lbl">IG Saves</div><div class="kpi-tgt">â†‘</div></div>'
      +'<div class="kpi-card"><div class="kpi-val">'+(data.energy_avg||0)+'</div><div class="kpi-lbl">Enerji Ort.</div><div class="kpi-tgt">â‰¥6</div></div>'
      +'<div class="kpi-card"><div class="kpi-val">%'+(data.habit_compliance_pct||0)+'</div><div class="kpi-lbl">Rutin Uyum</div><div class="kpi-tgt">â‰¥%70</div></div>'
      +'</div>';
  }catch(e){document.getElementById('kpi-view').innerHTML='<div class="empty">YÃ¼klenemedi</div>';}
}
function renderKPIForm(){
  const fields=[{id:'kf-task',l:'Task Tamamlama %'},{id:'kf-water',l:'Su 2.5L GÃ¼nleri'},{id:'kf-suppl',l:'Supplement Uyum %'},{id:'kf-reels',l:'Reels SayÄ±sÄ±'},{id:'kf-reach',l:'IG Reach ArtÄ±ÅŸÄ± %'},{id:'kf-saves',l:'IG Saves'},{id:'kf-energy',l:'Enerji OrtalamasÄ±'},{id:'kf-habit',l:'Rutin Uyum %'}];
  document.getElementById('kpi-form').innerHTML=fields.map(f=>'<div style="margin-bottom:8px"><div style="font-size:12px;color:var(--gray);font-weight:600;margin-bottom:3px">'+f.l+'</div><input type="number" id="'+f.id+'" class="ifield"></div>').join('');
}
async function saveKPI(){
  const g=id=>+(document.getElementById(id).value||0);
  try{
    await sb.from('weekly_kpi').upsert({week_start:getMonday(),microtask_completion_pct:g('kf-task'),water_days:g('kf-water'),supplement_pct:g('kf-suppl'),reels_published:g('kf-reels'),ig_reach_change:g('kf-reach'),ig_saves:g('kf-saves'),energy_avg:g('kf-energy'),habit_compliance_pct:g('kf-habit')},{onConflict:'week_start'});
    toast('ğŸ“Š KPI kaydedildi!');await loadKPI();
  }catch(e){toast('Hata: '+e.message);}
}

// â”€â”€ STREAK â”€â”€
async function calcStreak(){
  try{
    const{data}=await sb.from('daily_checkins').select('date').eq('type','morning').order('date',{ascending:false}).limit(60);
    if(!data||!data.length)return;
    let streak=0;const base=new Date();base.setHours(0,0,0,0);
    for(let i=0;i<data.length;i++){const exp=new Date(base);exp.setDate(base.getDate()-i);if(data[i].date===exp.toISOString().split('T')[0])streak++;else break;}
    document.getElementById('hdr-streak').textContent='ğŸ”¥ '+streak+' gÃ¼n';
  }catch(e){}
}

// â”€â”€ TELEGRAM â”€â”€
async function loadTGSettings(){
  updateCountdownDisplay();
  try{const{data}=await sb.from('notification_settings').select('*').limit(1).maybeSingle();if(data){if(data.telegram_bot_token)document.getElementById('tg-token').value=data.telegram_bot_token;if(data.telegram_chat_id)document.getElementById('tg-chatid').value=data.telegram_chat_id;}}catch(e){}
}
async function saveTG(){
  const token=document.getElementById('tg-token').value.trim(),chatId=document.getElementById('tg-chatid').value.trim();
  if(!token||!chatId){toast('Token ve Chat ID gerekli!');return;}
  try{const{data:ex}=await sb.from('notification_settings').select('id').limit(1).maybeSingle();if(ex)await sb.from('notification_settings').update({telegram_bot_token:token,telegram_chat_id:chatId}).eq('id',ex.id);else await sb.from('notification_settings').insert({telegram_bot_token:token,telegram_chat_id:chatId});toast('âœ… Telegram kaydedildi!');}catch(e){toast('Hata: '+e.message);}
}
async function testTG(){
  const token=document.getElementById('tg-token').value.trim(),chatId=document.getElementById('tg-chatid').value.trim();
  if(!token||!chatId){toast('Ã–nce token ve Chat ID gir!');return;}
  try{const r=await fetch('https://api.telegram.org/bot'+token+'/sendMessage',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id:chatId,text:'Lock-In 2025 baÄŸlantÄ±sÄ± kuruldu!'})});const d=await r.json();toast(d.ok?'âœ… Test gÃ¶nderildi!':'Hata: '+d.description);}catch(e){toast('BaÄŸlantÄ± hatasÄ±');}
}
async function sendTG(text){
  try{const{data}=await sb.from('notification_settings').select('*').limit(1).maybeSingle();if(!data||!data.telegram_bot_token)return;await fetch('https://api.telegram.org/bot'+data.telegram_bot_token+'/sendMessage',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id:data.telegram_chat_id,text})});}catch(e){}
}

// â”€â”€ EÄÄ°TÄ°M â”€â”€
let editEgitimId = null;

async function loadEgitim() {
  const el = document.getElementById('egitim-list');
  try {
    const {data: courses} = await sb.from('egitim_courses').select('*, egitim_logs(*)').order('created_at', {ascending: false});
    if (!courses || !courses.length) {
      el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“</div>HenÃ¼z eÄŸitim eklenmedi.</div>';
      return;
    }
    let h = '';
    courses.forEach(course => {
      const logs = course.egitim_logs || [];
      const lastLog = logs.sort((a,b) => new Date(b.logged_date) - new Date(a.logged_date))[0];
      const pct = lastLog ? (lastLog.progress_pct || 0) : 0;
      const totalMins = logs.reduce((s, l) => s + (l.duration_mins || 0), 0);
      const hrs = Math.floor(totalMins / 60);
      const mins = totalMins % 60;
      h += '<div class="card" style="margin-bottom:12px">'
        + '<div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:8px">'
        + '<div><div style="font-size:16px;font-weight:600">ğŸ“ ' + course.name + '</div>'
        + '<div style="font-size:12px;color:var(--gray);margin-top:2px">' + (course.platform || '') + (course.total_scope ? ' Â· ' + course.total_scope : '') + '</div></div>'
        + '<div style="display:flex;gap:6px">'
        + '<button class="btn btn-gold btn-sm" onclick="openEgitimLog(\'' + course.id + '\')">+ Log</button>'
        + '<button class="edit-btn" onclick="deleteEgitim(\'' + course.id + '\')">ğŸ—‘ï¸</button>'
        + '</div></div>'
        + '<div class="pbw"><div class="pbf" style="width:' + pct + '%"></div></div>'
        + '<div class="plbl" style="margin-bottom:10px"><span>Ä°lerleme</span><span>%' + pct + (course.deadline ? ' Â· Hedef: ' + course.deadline : '') + '</span></div>'
        + '<div style="display:flex;gap:10px;font-size:12px;color:var(--gray)">'
        + '<span>â±ï¸ ' + (hrs > 0 ? hrs + 's ' : '') + mins + 'dk Ã§alÄ±ÅŸÄ±ldÄ±</span>'
        + '<span>ğŸ“… ' + logs.length + ' oturum</span>'
        + (lastLog ? '<span>ğŸ—“ï¸ Son: ' + lastLog.logged_date + '</span>' : '') + '</div>';
      if (logs.length > 0) {
        h += '<div style="margin-top:10px;border-top:1px solid var(--gray-l);padding-top:10px">'
          + '<div style="font-size:11px;font-weight:600;color:var(--gray);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Son Loglar</div>';
        logs.slice(0,3).forEach(log => {
          h += '<div style="font-size:13px;padding:5px 0;border-bottom:1px solid var(--gray-l);display:flex;gap:8px">'
            + '<span style="color:var(--gold);font-weight:600;min-width:80px">' + log.logged_date + '</span>'
            + '<span style="flex:1;color:var(--gray)">' + (log.note || '') + '</span>'
            + (log.duration_mins ? '<span style="color:var(--navy);font-weight:500">' + log.duration_mins + 'dk</span>' : '')
            + '</div>';
        });
        h += '</div>';
      }
      h += '</div>';
    });
    el.innerHTML = h;
  } catch(e) {
    el.innerHTML = '<div class="empty">YÃ¼klenemedi: ' + e.message + '</div>';
  }
}

function openAddEgitim() {
  editEgitimId = null;
  document.getElementById('egitim-modal-title').textContent = 'Yeni EÄŸitim';
  document.getElementById('eg-name').value = '';
  document.getElementById('eg-platform').value = '';
  document.getElementById('eg-total').value = '';
  document.getElementById('eg-deadline').value = '';
  document.getElementById('egitim-modal').style.display = 'flex';
}

async function saveEgitim() {
  const name = document.getElementById('eg-name').value.trim();
  if (!name) { toast('EÄŸitim adÄ± gir!'); return; }
  try {
    await sb.from('egitim_courses').insert({
      name,
      platform: document.getElementById('eg-platform').value.trim(),
      total_scope: document.getElementById('eg-total').value.trim(),
      deadline: document.getElementById('eg-deadline').value || null,
    });
    closeModal('egitim-modal');
    toast('âœ… EÄŸitim eklendi!');
    await loadEgitim();
  } catch(e) { toast('Hata: ' + e.message); }
}

function openEgitimLog(courseId) {
  document.getElementById('eg-log-course-id').value = courseId;
  document.getElementById('eg-log-note').value = '';
  document.getElementById('eg-log-mins').value = '';
  document.getElementById('eg-log-pct').value = '';
  document.getElementById('egitim-log-modal').style.display = 'flex';
}

async function saveEgitimLog() {
  const courseId = document.getElementById('eg-log-course-id').value;
  const note = document.getElementById('eg-log-note').value.trim();
  const mins = parseInt(document.getElementById('eg-log-mins').value) || 0;
  const pct = parseInt(document.getElementById('eg-log-pct').value) || 0;
  try {
    await sb.from('egitim_logs').insert({
      course_id: courseId,
      note,
      duration_mins: mins,
      progress_pct: pct,
      logged_date: TODAY,
    });
    closeModal('egitim-log-modal');
    toast('âœ… Ä°lerleme kaydedildi!');
    await loadEgitim();
  } catch(e) { toast('Hata: ' + e.message); }
}

async function deleteEgitim(id) {
  if (!confirm('EÄŸitimi ve tÃ¼m loglarÄ± silmek istiyor musun?')) return;
  try {
    await sb.from('egitim_logs').delete().eq('course_id', id);
    await sb.from('egitim_courses').delete().eq('id', id);
    toast('Silindi');
    await loadEgitim();
  } catch(e) { toast('Hata: ' + e.message); }
}

// â”€â”€ SAÄLIK â”€â”€
async function loadSaglik() {
  document.getElementById('saglik-date').value = TODAY;
  try {
    // Load today's existing entry
    const {data} = await sb.from('health_logs').select('*').eq('log_date', TODAY).maybeSingle();
    if (data) {
      document.getElementById('saglik-sleep-h').value = data.sleep_hours || '';
      document.getElementById('saglik-sleep-q').value = data.sleep_quality || '';
      document.getElementById('saglik-exercise').value = data.exercise || '';
      document.getElementById('saglik-food').value = data.food || '';
      document.getElementById('saglik-water').value = data.water_liters || '';
      document.getElementById('saglik-note').value = data.note || '';
    }
    await loadSaglikHistory();
  } catch(e) {}
}

async function saveSaglik() {
  const date = document.getElementById('saglik-date').value || TODAY;
  try {
    await sb.from('health_logs').upsert({
      log_date: date,
      sleep_hours: parseFloat(document.getElementById('saglik-sleep-h').value) || null,
      sleep_quality: parseInt(document.getElementById('saglik-sleep-q').value) || null,
      exercise: document.getElementById('saglik-exercise').value.trim(),
      food: document.getElementById('saglik-food').value.trim(),
      water_liters: parseFloat(document.getElementById('saglik-water').value) || null,
      note: document.getElementById('saglik-note').value.trim(),
    }, {onConflict: 'log_date'});
    toast('âœ… SaÄŸlÄ±k logu kaydedildi!');
    await loadSaglikHistory();
  } catch(e) { toast('Hata: ' + e.message); }
}

async function loadSaglikHistory() {
  try {
    const {data} = await sb.from('health_logs').select('*').order('log_date', {ascending: false}).limit(14);
    const el = document.getElementById('saglik-history');
    if (!data || !data.length) { el.innerHTML = '<div class="empty">HenÃ¼z log yok.</div>'; return; }
    let h = '';
    data.forEach(d => {
      h += '<div style="padding:11px 0;border-bottom:1px solid var(--gray-l)">'
        + '<div style="display:flex;justify-content:space-between;margin-bottom:4px">'
        + '<span style="font-size:13px;font-weight:600">' + d.log_date + '</span>'
        + '<div style="display:flex;gap:8px;font-size:12px;color:var(--gray)">'
        + (d.sleep_hours ? 'ğŸ˜´ ' + d.sleep_hours + 's' : '')
        + (d.water_liters ? ' ğŸ’§ ' + d.water_liters + 'L' : '')
        + '</div></div>'
        + (d.exercise ? '<div style="font-size:12px;color:var(--green)">ğŸ‹ï¸ ' + d.exercise + '</div>' : '')
        + (d.food ? '<div style="font-size:12px;color:var(--gray)">ğŸ¥— ' + d.food + '</div>' : '')
        + (d.note ? '<div style="font-size:12px;color:var(--navy);margin-top:2px">ğŸ“ ' + d.note + '</div>' : '')
        + '</div>';
    });
    el.innerHTML = h;
  } catch(e) { document.getElementById('saglik-history').innerHTML = '<div class="empty">YÃ¼klenemedi</div>'; }
}

// â”€â”€ OPTÄ°MAÄ°ZED â”€â”€
async function loadOptimAIzed() {
  try {
    const {data} = await sb.from('optimaized_metrics').select('*').eq('week_start', getMonday()).maybeSingle();
    const el = document.getElementById('opt-metrics-view');
    if (!data) { el.innerHTML = '<div class="empty"><div class="empty-icon">âš¡</div>Bu hafta henÃ¼z metrik girilmedi.</div>'; }
    else {
      el.innerHTML = '<div class="kpi-grid">'
        + '<div class="kpi-card"><div class="kpi-val">' + (data.content_prepared||0) + '</div><div class="kpi-lbl">HazÄ±rlanan Ä°Ã§erik</div></div>'
        + '<div class="kpi-card"><div class="kpi-val">' + (data.content_published||0) + '</div><div class="kpi-lbl">PaylaÅŸÄ±lan Ä°Ã§erik</div></div>'
        + '<div class="kpi-card"><div class="kpi-val">' + (data.followers||0) + '</div><div class="kpi-lbl">TakipÃ§i</div><div class="kpi-tgt">+' + (data.follower_gain||0) + ' bu hafta</div></div>'
        + '<div class="kpi-card"><div class="kpi-val">' + (data.views||0) + '</div><div class="kpi-lbl">Ä°zlenme</div></div>'
        + '<div class="kpi-card"><div class="kpi-val">' + (data.likes||0) + '</div><div class="kpi-lbl">BeÄŸeni</div></div>'
        + '<div class="kpi-card"><div class="kpi-val">' + (data.saves||0) + '</div><div class="kpi-lbl">Kaydetme</div></div>'
        + '<div class="kpi-card"><div class="kpi-val">' + (data.reach||0) + '</div><div class="kpi-lbl">Reach</div></div>'
        + '<div class="kpi-card"><div class="kpi-val">' + (data.sales||0) + '</div><div class="kpi-lbl">SatÄ±ÅŸ</div><div class="kpi-tgt">â‚¬' + (data.revenue||0) + '</div></div>'
        + '</div>';
      // Pre-fill form
      const fMap = {prepared:'opt-prepared',published:'opt-published',reels:'opt-reels',stories:'opt-stories',followers:'opt-followers',follower_gain:'opt-follower-gain',views:'opt-views',likes:'opt-likes',saves:'opt-saves',reach:'opt-reach',sales:'opt-sales',revenue:'opt-revenue'};
      const dMap = {prepared:data.content_prepared,published:data.content_published,reels:data.reels,stories:data.stories,followers:data.followers,follower_gain:data.follower_gain,views:data.views,likes:data.likes,saves:data.saves,reach:data.reach,sales:data.sales,revenue:data.revenue};
      Object.entries(fMap).forEach(([k,id])=>{ const el2=document.getElementById(id); if(el2&&dMap[k]!=null) el2.value=dMap[k]; });
    }
    await loadOptHistory();
  } catch(e) { document.getElementById('opt-metrics-view').innerHTML = '<div class="empty">YÃ¼klenemedi</div>'; }
}

async function saveOptimAIzed() {
  const g = id => parseFloat(document.getElementById(id)?.value) || 0;
  try {
    await sb.from('optimaized_metrics').upsert({
      week_start: getMonday(),
      content_prepared: g('opt-prepared'), content_published: g('opt-published'),
      reels: g('opt-reels'), stories: g('opt-stories'),
      followers: g('opt-followers'), follower_gain: g('opt-follower-gain'),
      views: g('opt-views'), likes: g('opt-likes'), saves: g('opt-saves'),
      reach: g('opt-reach'), sales: g('opt-sales'), revenue: g('opt-revenue'),
    }, {onConflict: 'week_start'});
    toast('âœ… Metrikler kaydedildi!');
    await loadOptimAIzed();
  } catch(e) { toast('Hata: ' + e.message); }
}

async function loadOptHistory() {
  try {
    const {data} = await sb.from('optimaized_metrics').select('*').order('week_start', {ascending: false}).limit(8);
    const el = document.getElementById('opt-history');
    if (!data || !data.length) { el.innerHTML = '<div class="empty">HenÃ¼z veri yok.</div>'; return; }
    let h = '';
    data.forEach(d => {
      h += '<div style="padding:10px 0;border-bottom:1px solid var(--gray-l)">'
        + '<div style="font-size:12px;font-weight:600;color:var(--gold);margin-bottom:4px">Hafta: ' + d.week_start + '</div>'
        + '<div style="display:flex;flex-wrap:wrap;gap:8px;font-size:12px;color:var(--gray)">'
        + '<span>ğŸ“¤ ' + (d.content_published||0) + ' paylaÅŸÄ±m</span>'
        + '<span>ğŸ‘¥ ' + (d.followers||0) + ' takipÃ§i (+' + (d.follower_gain||0) + ')</span>'
        + '<span>ğŸ‘ï¸ ' + (d.views||0) + ' izlenme</span>'
        + '<span>ğŸ’° â‚¬' + (d.revenue||0) + '</span>'
        + '</div></div>';
    });
    el.innerHTML = h;
  } catch(e) {}
}

// â”€â”€ VÄ°SÄ°ON BOARD â”€â”€
let vbColor = '#F5EDD6';

async function loadVisionBoard() {
  try {
    const {data} = await sb.from('vision_board_items').select('*').order('created_at', {ascending: false});
    const el = document.getElementById('vb-grid');
    if (!data || !data.length) {
      el.innerHTML = '<div style="grid-column:1/-1" class="empty"><div class="empty-icon">ğŸŒŸ</div>HenÃ¼z hiÃ§bir ÅŸey yok.<br>GÃ¶rsel veya not ekle!</div>';
      return;
    }
    let h = '';
    data.forEach(item => {
      if (item.type === 'image') {
        h += '<div style="position:relative;border-radius:12px;overflow:hidden;aspect-ratio:1;background:var(--gray-l)">'
          + '<img src="' + item.content + '" style="width:100%;height:100%;object-fit:cover">'
          + '<button onclick="deleteVBItem(\'' + item.id + '\')" style="position:absolute;top:6px;right:6px;width:24px;height:24px;border-radius:50%;border:none;background:rgba(0,0,0,.5);color:#fff;cursor:pointer;font-size:11px">âœ•</button>'
          + '</div>';
      } else {
        const textColor = item.bg_color === '#1B2A4A' ? '#fff' : 'var(--navy)';
        h += '<div style="position:relative;border-radius:12px;padding:14px;background:' + (item.bg_color||'#F5EDD6') + ';aspect-ratio:1;display:flex;align-items:center;justify-content:center">'
          + '<div style="font-size:13px;font-weight:500;text-align:center;color:' + textColor + ';line-height:1.5">' + item.content + '</div>'
          + '<button onclick="deleteVBItem(\'' + item.id + '\')" style="position:absolute;top:6px;right:6px;width:24px;height:24px;border-radius:50%;border:none;background:rgba(0,0,0,.2);color:#fff;cursor:pointer;font-size:11px">âœ•</button>'
          + '</div>';
      }
    });
    el.innerHTML = h;
  } catch(e) {
    document.getElementById('vb-grid').innerHTML = '<div style="grid-column:1/-1" class="empty">YÃ¼klenemedi: ' + e.message + '</div>';
  }
}

function openAddVBNote() {
  vbColor = '#F5EDD6';
  document.getElementById('vb-note-text').value = '';
  // Reset color picker borders
  document.querySelectorAll('#vb-color-picker div').forEach(d => d.style.border = '2px solid transparent');
  document.querySelector('#vb-color-picker div').style.border = '2px solid var(--gold)';
  document.getElementById('vb-note-modal').style.display = 'flex';
}

function selVBColor(color) {
  vbColor = color;
  document.querySelectorAll('#vb-color-picker div').forEach(d => {
    d.style.border = d.style.background === color || d.getAttribute('style').includes(color) ? '2px solid var(--gold)' : '2px solid transparent';
  });
}

async function saveVBNote() {
  const text = document.getElementById('vb-note-text').value.trim();
  if (!text) { toast('Bir ÅŸeyler yaz!'); return; }
  try {
    await sb.from('vision_board_items').insert({type: 'note', content: text, bg_color: vbColor});
    closeModal('vb-note-modal');
    toast('âœ… Eklendi!');
    await loadVisionBoard();
  } catch(e) { toast('Hata: ' + e.message); }
}

async function uploadVBImage(event) {
  const file = event.target.files[0];
  if (!file) return;
  toast('GÃ¶rsel yÃ¼kleniyor...');
  const reader = new FileReader();
  reader.onload = async (e) => {
    try {
      await sb.from('vision_board_items').insert({type: 'image', content: e.target.result});
      toast('âœ… GÃ¶rsel eklendi!');
      await loadVisionBoard();
    } catch(err) { toast('Hata: ' + err.message); }
  };
  reader.readAsDataURL(file);
  event.target.value = '';
}

async function deleteVBItem(id) {
  await sb.from('vision_board_items').delete().eq('id', id);
  toast('Silindi');
  await loadVisionBoard();
}

function saveCountdownDate() {
  const val = document.getElementById('countdown-new-date').value;
  if (!val) { toast('Bir tarih seÃ§!'); return; }
  localStorage.setItem(DEADLINE_KEY, val + 'T00:00:00');
  updateCountdown();
  updateCountdownDisplay();
  toast('âœ… Hedef tarih gÃ¼ncellendi!');
}

function updateCountdownDisplay() {
  const d = getDeadline();
  const diff = Math.ceil((d - new Date()) / (1000 * 60 * 60 * 24));
  const MN2 = ['Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];
  const el1 = document.getElementById('countdown-current-date');
  const el2 = document.getElementById('countdown-days-left');
  if (el1) el1.textContent = d.getDate() + ' ' + MN2[d.getMonth()] + ' ' + d.getFullYear();
  if (el2) el2.textContent = diff > 0 ? diff + ' gÃ¼n kaldÄ±' : 'SÃ¼re doldu';
}

// â”€â”€ UTILS â”€â”€
function getMonday(){const d=new Date();const day=d.getDay();const diff=d.getDate()-day+(day===0?-6:1);d.setDate(diff);return d.toISOString().split('T')[0];}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}
function closeModal(id){document.getElementById(id).style.display='none';}
function closeMBg(ev,id){if(ev.target===document.getElementById(id))closeModal(id);}

// Init
setPrio('med');
setSize('medium');
</script>
</body>
</html>
